<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e40af">
    <title>Super Quiz Bros - Quiz Educativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            overflow-x: hidden;
            overscroll-behavior: none;
        }
        
        .pixel-font { font-family: 'Press Start 2P', monospace; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes walk {
            0% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            100% { transform: rotate(-5deg); }
        }

        @keyframes floatCloud {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-in; }
        .pulse { animation: pulse 1s infinite; }

        .character-container {
            font-size: 80px;
            filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.3));
            transition: all 0.3s;
        }
        .character-happy { animation: bounce 0.5s infinite; }
        .character-sad { filter: grayscale(100%); transform: scale(0.9); }
        .character-thinking { animation: walk 2s infinite; }

        .speech-bubble {
            position: relative;
            background: #fff;
            border: 4px solid #000;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            line-height: 1.5;
            color: #000;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            left: 20px;
            bottom: -14px;
            border: 7px solid transparent;
            border-top-color: #000;
        }

        .player-indicator { animation: pulse 1s infinite; }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        /* Anima√ß√µes estilo Super Mario World 16-bit */
        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.5); }
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes blockBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 6px 0px #7f1d1d, 0 8px 10px rgba(0,0,0,0.3); }
            50% { transform: scale(1.05); box-shadow: 0 4px 0px #7f1d1d, 0 6px 8px rgba(0,0,0,0.3); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        @keyframes confettiFall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes firework {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body class="m-0 p-0 bg-black">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- IMPORTANTE: Substitua abaixo pela sua chave do Google AI Studio ---
        // Se deixar vazio, o jogo usar√° apenas perguntas locais.
        const API_KEY_PADRAO = "AIzaSyAY6EdwtkjqmYrt51eEQXGnfTZrBTRicio"; 

        // Perguntas de fallback caso a API falhe ou n√£o tenha chave
        const fallbackQuestions = [
            {
                pergunta: "Em 'O menino correu muito', o verbo 'correu' indica:",
                alternativas: { A: "Estado", B: "A√ß√£o", C: "Fen√¥meno da natureza", D: "Qualidade" },
                correta: "B",
                explicacao: "Verbos de a√ß√£o indicam algo que o sujeito faz. Correr √© uma a√ß√£o."
            },
            {
                pergunta: "Qual √© o resultado de -5 + 8?",
                alternativas: { A: "-3", B: "-13", C: "+3", D: "+13" },
                correta: "C",
                explicacao: "Sinais diferentes: conserva o sinal do maior (8) e subtrai. 8 - 5 = 3."
            },
            {
                pergunta: "Qual √© a capital do Brasil?",
                alternativas: { A: "Rio de Janeiro", B: "S√£o Paulo", C: "Bras√≠lia", D: "Salvador" },
                correta: "C",
                explicacao: "Bras√≠lia foi inaugurada em 1960 para ser a capital federal."
            }
        ];

        const SoundButton = ({ soundEnabled, onClick }) => (
            <button 
                onClick={onClick} 
                className="fixed top-4 right-4 z-50 bg-yellow-400 border-4 border-black p-2 rounded shadow-lg hover:scale-110 transition-transform"
                title={soundEnabled ? "Desligar som" : "Ligar som"}
            >
                {soundEnabled ? "üîä" : "üîá"}
            </button>
        );

        function MarioQuizGame() {
            const [screen, setScreen] = useState('prestart');
            const [gameMode, setGameMode] = useState('1P');
            const [player1Name, setPlayer1Name] = useState('Mario');
            const [player2Name, setPlayer2Name] = useState('Luigi');
            const [subject, setSubject] = useState('');
            const [difficulty, setDifficulty] = useState('medio');
            const [educationLevel, setEducationLevel] = useState('');
            const [course, setCourse] = useState('');
            const [apiKey, setApiKey] = useState(API_KEY_PADRAO);
            
            const [currentPlayer, setCurrentPlayer] = useState(1);
            const [player1Score, setPlayer1Score] = useState(0);
            const [player2Score, setPlayer2Score] = useState(0);
            const [player1Lives, setPlayer1Lives] = useState(3);
            const [player2Lives, setPlayer2Lives] = useState(3);
            const [player1Streak, setPlayer1Streak] = useState(0);
            const [player2Streak, setPlayer2Streak] = useState(0);
            const [showBonusLife, setShowBonusLife] = useState(false);
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [characterMood, setCharacterMood] = useState('thinking');
            const [isLoading, setIsLoading] = useState(false);
            
            const [showExplanation, setShowExplanation] = useState(false);
            const [explanationData, setExplanationData] = useState({ correct: false, text: '' });
            const [errorMsg, setErrorMsg] = useState('');
            const [apiStatus, setApiStatus] = useState(''); // 'online' ou 'offline'
            const [ranking, setRanking] = useState([]);
            const [showRanking, setShowRanking] = useState(false);

            // Carregar ranking do localStorage ao iniciar
            useEffect(() => {
                const savedRanking = localStorage.getItem('quizRanking');
                if (savedRanking) {
                    setRanking(JSON.parse(savedRanking));
                }
            }, []);

            // Salvar no ranking
            const saveToRanking = (playerName, score) => {
                const newEntry = {
                    id: Date.now(),
                    name: playerName,
                    score: score,
                    subject: subject,
                    difficulty: difficulty,
                    educationLevel: educationLevel,
                    course: course || '',
                    date: new Date().toLocaleDateString('pt-BR')
                };

                const updatedRanking = [...ranking, newEntry]
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 10); // Manter apenas top 10

                setRanking(updatedRanking);
                localStorage.setItem('quizRanking', JSON.stringify(updatedRanking));
            };

            // Limpar ranking
            const clearRanking = () => {
                if (confirm('Tem certeza que deseja limpar o ranking?')) {
                    setRanking([]);
                    localStorage.removeItem('quizRanking');
                    playSound('select');
                }
            };

            // Obter label da dificuldade
            const getDifficultyLabel = (diff) => {
                const labels = { 'facil': 'üòä F√°cil', 'medio': 'üòê M√©dio', 'dificil': 'üòà Dif√≠cil' };
                return labels[diff] || diff;
            };

            // Obter label do n√≠vel de ensino
            const getEducationLabel = (edu) => {
                const labels = {
                    'infantil': 'üßí Infantil',
                    'fundamental1': 'üë¶ Fund. I',
                    'fundamental2': 'üßë Fund. II',
                    'medio': 'üë®‚Äçüéì M√©dio',
                    'superior': 'üéì Superior'
                };
                return labels[edu] || edu;
            };
            
            const [soundEnabled, setSoundEnabled] = useState(true);
            const synthRef = useRef(null);
            const currentMusicRef = useRef(null);
            const [currentScreen, setCurrentScreen] = useState('');

            // Defini√ß√£o das m√∫sicas para cada tela
            const musicPatterns = {
                // Tela inicial - estilo Donkey Kong Country (ambiente tropical)
                prestart: {
                    notes: ['C3', 'E3', 'G3', 'C4', 'E4', 'G3', 'C4', 'E4', 'G4', 'E4', 'C4', 'G3', 'E3', 'G3', 'C4', 'G3'],
                    tempo: '4n',
                    volume: -15
                },
                // Sele√ß√£o de modo - melodia animada
                mode: {
                    notes: ['E4', 'G4', 'A4', 'G4', 'E4', 'D4', 'E4', 'G4'],
                    tempo: '8n',
                    volume: -18
                },
                // Sele√ß√£o de educa√ß√£o - melodia suave
                education: {
                    notes: ['C4', 'E4', 'G4', 'E4', 'F4', 'A4', 'G4', 'E4'],
                    tempo: '4n',
                    volume: -18
                },
                // Config superior - melodia acad√™mica
                superior_config: {
                    notes: ['G3', 'B3', 'D4', 'G4', 'F4', 'D4', 'B3', 'G3'],
                    tempo: '4n',
                    volume: -18
                },
                // Configura√ß√£o - melodia preparat√≥ria
                config: {
                    notes: ['D4', 'F4', 'A4', 'F4', 'D4', 'A3', 'D4', 'F4'],
                    tempo: '4n',
                    volume: -18
                },
                // Jogo - melodia de a√ß√£o/tens√£o
                question: {
                    notes: ['A3', 'C4', 'E4', 'A4', 'G4', 'E4', 'C4', 'A3', 'B3', 'D4', 'F4', 'B4', 'A4', 'F4', 'D4', 'B3'],
                    tempo: '8n',
                    volume: -20
                },
                // Game over - melodia triste
                gameover: {
                    notes: ['E3', 'D3', 'C3', 'B2', 'C3', 'D3', 'C3', 'B2'],
                    tempo: '2n',
                    volume: -16
                },
                // Ranking - melodia vitoriosa
                ranking: {
                    notes: ['C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4', 'G4', 'E4', 'C4', 'E4', 'G4'],
                    tempo: '4n',
                    volume: -16
                },
                // Vit√≥ria - melodia √©pica de celebra√ß√£o
                victory: {
                    notes: ['C4', 'E4', 'G4', 'C5', 'E5', 'G5', 'C6', 'G5', 'E5', 'C5', 'G4', 'E4', 'C4', 'E4', 'G4', 'C5'],
                    tempo: '8n',
                    volume: -12
                }
            };

            const initAudio = async () => {
                if (!synthRef.current) {
                    try {
                        await Tone.start();
                        synthRef.current = new Tone.PolySynth(Tone.Synth, {
                            oscillator: { type: 'square' },
                            envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.3 }
                        }).toDestination();
                        synthRef.current.volume.value = -10;
                    } catch(e) {
                        console.log('Audio n√£o dispon√≠vel');
                    }
                }
            };

            const stopMusic = () => {
                if (currentMusicRef.current) {
                    currentMusicRef.current.stop();
                    currentMusicRef.current.dispose();
                    currentMusicRef.current = null;
                }
                Tone.Transport.stop();
                Tone.Transport.cancel();
            };

            const playMusic = (screenName) => {
                if (!soundEnabled) return;
                
                stopMusic();
                
                const pattern = musicPatterns[screenName];
                if (!pattern) return;

                try {
                    const synth = new Tone.Synth({
                        oscillator: { type: 'triangle' },
                        envelope: { attack: 0.05, decay: 0.2, sustain: 0.3, release: 0.5 }
                    }).toDestination();
                    synth.volume.value = pattern.volume;

                    currentMusicRef.current = new Tone.Sequence((time, note) => {
                        if (note) {
                            synth.triggerAttackRelease(note, pattern.tempo, time);
                        }
                    }, pattern.notes, pattern.tempo);

                    currentMusicRef.current.loop = true;
                    Tone.Transport.bpm.value = screenName === 'question' ? 120 : screenName === 'gameover' ? 60 : 90;
                    Tone.Transport.start();
                    currentMusicRef.current.start(0);
                } catch(e) {
                    console.log('Erro ao tocar m√∫sica:', e);
                }
            };

            // Efeito para trocar m√∫sica quando a tela muda
            useEffect(() => {
                if (soundEnabled && screen !== currentScreen) {
                    setCurrentScreen(screen);
                    playMusic(screen);
                }
                return () => {
                    // Cleanup ao desmontar
                };
            }, [screen, soundEnabled]);

            // Toggle som
            const toggleSound = async () => {
                const newState = !soundEnabled;
                setSoundEnabled(newState);
                if (!newState) {
                    stopMusic();
                } else {
                    await initAudio();
                    playMusic(screen);
                }
            };

            const playSound = (type) => {
                if (!soundEnabled || !synthRef.current) return;
                try {
                    const now = Tone.now();
                    switch(type) {
                        case 'coin': 
                            synthRef.current.triggerAttackRelease("E5", "0.1", now);
                            synthRef.current.triggerAttackRelease("G5", "0.1", now + 0.1);
                            break;
                        case 'wrong': 
                            synthRef.current.triggerAttackRelease("C3", "0.2", now);
                            synthRef.current.triggerAttackRelease("B2", "0.3", now + 0.2);
                            break;
                        case 'start': 
                            synthRef.current.triggerAttackRelease("C4", "0.1", now);
                            synthRef.current.triggerAttackRelease("E4", "0.1", now + 0.1);
                            synthRef.current.triggerAttackRelease("G4", "0.1", now + 0.2);
                            synthRef.current.triggerAttackRelease("C5", "0.2", now + 0.3);
                            break;
                        case 'switch': 
                            synthRef.current.triggerAttackRelease("G4", "0.1", now);
                            synthRef.current.triggerAttackRelease("C5", "0.1", now + 0.1);
                            break;
                        case 'select':
                            synthRef.current.triggerAttackRelease("E4", "0.05", now);
                            break;
                        case 'gameover':
                            synthRef.current.triggerAttackRelease("C4", "0.3", now);
                            synthRef.current.triggerAttackRelease("G3", "0.3", now + 0.3);
                            synthRef.current.triggerAttackRelease("E3", "0.3", now + 0.6);
                            synthRef.current.triggerAttackRelease("C3", "0.5", now + 0.9);
                            break;
                        case 'victory':
                            synthRef.current.triggerAttackRelease("C4", "0.15", now);
                            synthRef.current.triggerAttackRelease("E4", "0.15", now + 0.15);
                            synthRef.current.triggerAttackRelease("G4", "0.15", now + 0.3);
                            synthRef.current.triggerAttackRelease("C5", "0.15", now + 0.45);
                            synthRef.current.triggerAttackRelease("G4", "0.15", now + 0.6);
                            synthRef.current.triggerAttackRelease("C5", "0.3", now + 0.75);
                            break;
                    }
                } catch(e) {}
            };

            // --- L√≥gica da API do Gemini ---
            const fetchQuestionFromGemini = async () => {
                // Se n√£o tiver chave ou a chave for a padr√£o n√£o substitu√≠da
                if (!apiKey || apiKey === "COLE_SUA_CHAVE_AQUI") {
                    throw new Error("Chave de API n√£o configurada");
                }

                const difficultyText = {
                    'facil': 'f√°cil (perguntas simples e diretas)',
                    'medio': 'm√©dio (perguntas moderadas)',
                    'dificil': 'dif√≠cil (perguntas desafiadoras e complexas)'
                };

                // Temas variados para cada n√≠vel de ensino
                const temasInfantil = [
                    'cores e formas', 'animais da fazenda', 'animais da floresta', 'frutas', 
                    'partes do corpo', 'fam√≠lia', 'brinquedos', 'alimentos saud√°veis',
                    'meios de transporte', 'profiss√µes', 'esta√ß√µes do ano', 'dia e noite',
                    'n√∫meros de 1 a 10', 'tamanhos (grande/pequeno)', 'sons dos animais',
                    'higiene pessoal', 'roupas', 'clima (sol/chuva)', 'sentimentos',
                    'objetos da casa', 'objetos da escola', 'animais aqu√°ticos'
                ];

                const temasFundamental1 = [
                    'sistema solar', 'ciclo da √°gua', 'plantas', 'corpo humano',
                    'hist√≥ria do Brasil', 'mapas e regi√µes', 'folclore brasileiro',
                    'opera√ß√µes matem√°ticas', 'tabuada', 'fra√ß√µes simples',
                    'tipos de texto', 'pontua√ß√£o', 'sin√¥nimos e ant√¥nimos',
                    'animais vertebrados', 'animais invertebrados', 'cadeia alimentar'
                ];

                const temasFundamental2 = [
                    'equa√ß√µes', 'geometria', 'porcentagem', 'gr√°ficos',
                    'gram√°tica avan√ßada', 'literatura brasileira', 'interpreta√ß√£o de texto',
                    'c√©lulas', 'sistemas do corpo', 'ecologia', 'qu√≠mica b√°sica',
                    'hist√≥ria mundial', 'geografia f√≠sica', 'cidadania'
                ];

                const temasMedio = [
                    'fun√ß√µes matem√°ticas', 'trigonometria', 'estat√≠stica',
                    'f√≠sica mec√¢nica', 'f√≠sica el√©trica', 'qu√≠mica org√¢nica',
                    'biologia celular', 'gen√©tica', 'evolu√ß√£o',
                    'filosofia', 'sociologia', 'atualidades',
                    'literatura portuguesa', 'reda√ß√£o', 'gram√°tica'
                ];

                // Gera n√∫meros aleat√≥rios para variar as perguntas
                const randomSeed = Math.floor(Math.random() * 100000);
                const questionNumber = currentQIndex + 1;
                
                // Seleciona um tema aleat√≥rio baseado no n√≠vel
                let temaAleatorio = '';
                let temasDisponiveis = [];
                
                if (educationLevel === 'infantil') {
                    temasDisponiveis = temasInfantil;
                } else if (educationLevel === 'fundamental1') {
                    temasDisponiveis = temasFundamental1;
                } else if (educationLevel === 'fundamental2') {
                    temasDisponiveis = temasFundamental2;
                } else if (educationLevel === 'medio') {
                    temasDisponiveis = temasMedio;
                }
                
                if (temasDisponiveis.length > 0) {
                    temaAleatorio = temasDisponiveis[Math.floor(Math.random() * temasDisponiveis.length)];
                }

                const educationLevelText = {
                    'infantil': `Educa√ß√£o Infantil (crian√ßas de 4-5 anos). 
                        - Use linguagem MUITO simples e palavras curtas
                        - Perguntas devem ser divertidas e l√∫dicas
                        - Use situa√ß√µes do dia-a-dia da crian√ßa
                        - Alternativas devem ser curtas (1-3 palavras)
                        - Pode usar contextos como: brincadeiras, desenhos, fam√≠lia, escola`,
                    'fundamental1': 'Ensino Fundamental - Anos Iniciais (1¬∫ ao 5¬∫ ano, crian√ßas de 6-10 anos). Use linguagem simples e acess√≠vel, perguntas adequadas para crian√ßas.',
                    'fundamental2': 'Ensino Fundamental - Anos Finais (6¬∫ ao 9¬∫ ano, jovens de 11-14 anos). Use linguagem adequada para pr√©-adolescentes.',
                    'medio': 'Ensino M√©dio (jovens de 15-17 anos). Use linguagem e complexidade adequadas para adolescentes.',
                    'superior': `Ensino Superior - Curso de ${course}. Use linguagem t√©cnica e acad√™mica apropriada para universit√°rios.`
                };

                let contextInfo = educationLevelText[educationLevel] || 'Ensino geral';
                
                // Instru√ß√£o espec√≠fica para variar o tema
                let instrucaoTema = '';
                if (temaAleatorio && educationLevel !== 'superior') {
                    instrucaoTema = `\n- IMPORTANTE: Para esta pergunta, foque especificamente em "${temaAleatorio}" dentro do tema "${subject}"`;
                }
                
                const prompt = `Voc√™ √© um professor especialista criando uma avalia√ß√£o educativa.

CONTEXTO DO ALUNO:
- N√≠vel de ensino: ${contextInfo}
- Mat√©ria/Conte√∫do: ${subject}
- N√≠vel de dificuldade: ${difficultyText[difficulty]}

INSTRU√á√ïES OBRIGAT√ìRIAS:
- Pergunta n√∫mero: ${questionNumber}
- C√≥digo √∫nico: ${randomSeed}
- Crie 1 pergunta COMPLETAMENTE NOVA e DIFERENTE sobre "${subject}"${instrucaoTema}
- A pergunta DEVE ser 100% adequada ao n√≠vel de ensino
${educationLevel === 'infantil' ? `
- REGRAS ESPECIAIS PARA CRIAN√áAS (4-5 anos):
  * Perguntas MUITO curtas e simples
  * Use palavras que crian√ßas conhecem
  * Contextos: animais, cores, n√∫meros pequenos, fam√≠lia, escola
  * Alternativas com no m√°ximo 3 palavras cada
  * Pode usar emojis nas alternativas
  * Exemplos bons: "Qual animal faz AU AU?", "Que cor √© o c√©u?", "Quantas patas tem um cachorro?"
` : ''}
${educationLevel === 'fundamental1' ? '- Use exemplos do cotidiano, linguagem clara e acess√≠vel para crian√ßas.' : ''}
${educationLevel === 'fundamental2' ? '- Pode usar conceitos mais elaborados, adequados para pr√©-adolescentes.' : ''}
${educationLevel === 'medio' ? '- Use linguagem e complexidade adequadas para adolescentes do ensino m√©dio.' : ''}
${educationLevel === 'superior' ? `- A pergunta deve ser espec√≠fica do curso de ${course}, com linguagem t√©cnica e acad√™mica.` : ''}
- SEJA MUITO CRIATIVO - n√£o repita perguntas comuns ou √≥bvias
- Explore √¢ngulos diferentes e curiosidades sobre o tema

Responda APENAS com este JSON exato, sem markdown, sem crases:
{
    "pergunta": "O texto da pergunta aqui",
    "alternativas": {
        "A": "op√ß√£o 1",
        "B": "op√ß√£o 2",
        "C": "op√ß√£o 3",
        "D": "op√ß√£o 4"
    },
    "correta": "A",
    "explicacao": "Breve explica√ß√£o do porqu√™ est√° correta"
}`;

                console.log('üîç Buscando pergunta sobre:', subject, '| Tema:', temaAleatorio);
                console.log('üîë API Key:', apiKey.substring(0, 10) + '...');

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: {
                                temperature: 0.95,
                                topP: 0.99,
                                topK: 50
                            }
                        })
                    }
                );

                console.log('üì° Status da resposta:', response.status);

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('‚ùå Erro da API:', errorData);
                    throw new Error(`API erro ${response.status}: ${errorData.substring(0, 100)}`);
                }

                const data = await response.json();
                console.log('üì¶ Resposta completa:', data);
                
                const text = data.candidates[0].content.parts[0].text;
                console.log('üìù Texto recebido:', text);
                
                // Limpeza robusta do JSON
                const cleanText = text.replace(/```json/g, '').replace(/```/g, '').trim();
                const parsed = JSON.parse(cleanText);
                console.log('‚úÖ Pergunta parseada:', parsed);
                
                return parsed;
            };

            const loadQuestion = async () => {
                setIsLoading(true);
                setCharacterMood('thinking');
                setErrorMsg('');
                
                try {
                    const question = await fetchQuestionFromGemini();
                    setCurrentQuestion(question);
                    setApiStatus('online');
                    console.log('‚úÖ Pergunta carregada da API:', question);
                } catch (error) {
                    console.error("‚ùå Erro na API:", error);
                    // Usa pergunta local se a API falhar
                    const fallback = fallbackQuestions[Math.floor(Math.random() * fallbackQuestions.length)];
                    setCurrentQuestion(fallback);
                    setApiStatus('offline');
                    setErrorMsg(`ERRO: ${error.message}`);
                }
                
                setIsLoading(false);
            };

            const startGame = async () => {
                if (!subject.trim()) {
                    setErrorMsg('Por favor, digite uma mat√©ria!');
                    return;
                }
                
                initAudio();
                playSound('start');
                
                // Reset total
                setPlayer1Score(0);
                setPlayer2Score(0);
                setPlayer1Lives(3);
                setPlayer2Lives(3);
                setPlayer1Streak(0);
                setPlayer2Streak(0);
                setShowBonusLife(false);
                setCurrentPlayer(1);
                setCurrentQIndex(0);
                
                setScreen('question');
                await loadQuestion();
            };

            const handleAnswer = (key) => {
                if (!currentQuestion) return;
                
                const isCorrect = key === currentQuestion.correta;
                
                if (isCorrect) {
                    playSound('coin');
                    let newScore = 0;
                    if (currentPlayer === 1) {
                        newScore = player1Score + 100;
                        setPlayer1Score(newScore);
                        const newStreak = player1Streak + 1;
                        setPlayer1Streak(newStreak);
                        // A cada 3 acertos consecutivos, ganha vida extra
                        if (newStreak > 0 && newStreak % 3 === 0) {
                            setPlayer1Lives(l => l + 1);
                            setShowBonusLife(true);
                            setTimeout(() => setShowBonusLife(false), 2000);
                        }
                        // Verifica se atingiu pontua√ß√£o m√°xima
                        if (newScore >= 9999) {
                            setPlayer1Score(9999);
                            setScreen('victory');
                            return;
                        }
                    } else {
                        newScore = player2Score + 100;
                        setPlayer2Score(newScore);
                        const newStreak = player2Streak + 1;
                        setPlayer2Streak(newStreak);
                        if (newStreak > 0 && newStreak % 3 === 0) {
                            setPlayer2Lives(l => l + 1);
                            setShowBonusLife(true);
                            setTimeout(() => setShowBonusLife(false), 2000);
                        }
                        // Verifica se atingiu pontua√ß√£o m√°xima
                        if (newScore >= 9999) {
                            setPlayer2Score(9999);
                            setScreen('victory');
                            return;
                        }
                    }
                    
                    setCharacterMood('happy');
                    setExplanationData({ correct: true, text: currentQuestion.explicacao });
                } else {
                    playSound('wrong');
                    if (currentPlayer === 1) {
                        setPlayer1Lives(l => l - 1);
                        setPlayer1Streak(0); // Reset streak ao errar
                    } else {
                        setPlayer2Lives(l => l - 1);
                        setPlayer2Streak(0);
                    }
                    
                    setCharacterMood('sad');
                    setExplanationData({ 
                        correct: false, 
                        text: `A resposta correta era ${currentQuestion.correta}. ${currentQuestion.explicacao}` 
                    });
                }
                setShowExplanation(true);
            };

            const nextStep = async () => {
                setShowExplanation(false);
                
                // Checar Game Over
                const p1Dead = player1Lives <= 0;
                const p2Dead = gameMode === '2P' && player2Lives <= 0;
                
                if (gameMode === '1P' && p1Dead) {
                    setScreen('gameover');
                    return;
                }
                
                if (gameMode === '2P') {
                    if (p1Dead && p2Dead) {
                        setScreen('gameover');
                        return;
                    }
                    // Troca de turno se ambos vivos, ou mantem quem est√° vivo
                    if (!p1Dead && !p2Dead) {
                        setCurrentPlayer(prev => prev === 1 ? 2 : 1);
                        playSound('switch');
                    } else if (p1Dead) {
                        setCurrentPlayer(2);
                    } else if (p2Dead) {
                        setCurrentPlayer(1);
                    }
                }
                
                setCurrentQIndex(i => i + 1);
                await loadQuestion();
            };

            // Renderiza√ß√£o das Telas
            if (screen === 'prestart') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-blue-900 via-blue-700 to-blue-500 text-white fade-in p-4 relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Estrelas de fundo animadas */}
                        <div className="absolute inset-0 overflow-hidden">
                            {[...Array(30)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-yellow-300"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 60}%`,
                                        animation: `twinkle ${1 + Math.random() * 2}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`,
                                        fontSize: `${Math.random() * 6 + 2}px`
                                    }}
                                >‚òÖ</div>
                            ))}
                        </div>

                        {/* Nuvens estilo 16-bit */}
                        <div className="absolute top-8 left-[5%] opacity-90" style={{animation: 'floatCloud 8s ease-in-out infinite'}}>
                            <div className="flex">
                                <div className="w-8 h-8 bg-white rounded-full"></div>
                                <div className="w-12 h-12 bg-white rounded-full -ml-4 -mt-2"></div>
                                <div className="w-10 h-10 bg-white rounded-full -ml-4 mt-1"></div>
                            </div>
                        </div>
                        <div className="absolute top-20 right-[10%] opacity-70" style={{animation: 'floatCloud 10s ease-in-out infinite reverse'}}>
                            <div className="flex">
                                <div className="w-6 h-6 bg-white rounded-full"></div>
                                <div className="w-10 h-10 bg-white rounded-full -ml-3 -mt-2"></div>
                                <div className="w-8 h-8 bg-white rounded-full -ml-3 mt-1"></div>
                            </div>
                        </div>
                        <div className="absolute top-32 left-[20%] opacity-60" style={{animation: 'floatCloud 12s ease-in-out infinite'}}>
                            <div className="flex">
                                <div className="w-5 h-5 bg-white rounded-full"></div>
                                <div className="w-8 h-8 bg-white rounded-full -ml-2 -mt-1"></div>
                                <div className="w-6 h-6 bg-white rounded-full -ml-2 mt-1"></div>
                            </div>
                        </div>

                        {/* T√≠tulo principal estilo 16-bit */}
                        <div className="relative z-10 mb-2 md:mb-4">
                            <h1 
                                className="text-2xl md:text-5xl text-yellow-400 pixel-font text-center leading-relaxed"
                                style={{
                                    textShadow: '2px 2px 0px #b45309, 4px 4px 0px #78350f, -1px -1px 0px #fef08a',
                                    animation: 'titlePulse 2s ease-in-out infinite'
                                }}
                            >
                                SUPER
                            </h1>
                            <h1 
                                className="text-2xl md:text-5xl text-yellow-400 pixel-font text-center leading-relaxed"
                                style={{
                                    textShadow: '2px 2px 0px #b45309, 4px 4px 0px #78350f, -1px -1px 0px #fef08a',
                                    animation: 'titlePulse 2s ease-in-out infinite',
                                    animationDelay: '0.1s'
                                }}
                            >
                                QUIZ BROS
                            </h1>
                        </div>

                        {/* Subt√≠tulo animado - Blocos com texto */}
                        <div className="flex gap-1 mb-4 md:mb-8 relative z-10">
                            {['V','I','V','E','N','D','O'].map((letter, i) => (
                                <div 
                                    key={i}
                                    className="w-6 h-6 md:w-10 md:h-10 bg-yellow-500 border-2 md:border-4 border-yellow-700 rounded flex items-center justify-center pixel-font text-xs md:text-sm text-yellow-900 font-bold"
                                    style={{
                                        animation: 'blockBounce 0.5s ease-in-out infinite',
                                        animationDelay: `${i * 0.1}s`,
                                        boxShadow: 'inset -2px -2px 0px #b45309, inset 2px 2px 0px #fef08a'
                                    }}
                                >{letter}</div>
                            ))}
                        </div>
                        <div className="flex gap-1 mb-2 relative z-10">
                            {['V','A','L','O','R','E','S'].map((letter, i) => (
                                <div 
                                    key={i}
                                    className="w-6 h-6 md:w-10 md:h-10 bg-yellow-500 border-2 md:border-4 border-yellow-700 rounded flex items-center justify-center pixel-font text-xs md:text-sm text-yellow-900 font-bold"
                                    style={{
                                        animation: 'blockBounce 0.5s ease-in-out infinite',
                                        animationDelay: `${(i + 7) * 0.1}s`,
                                        boxShadow: 'inset -2px -2px 0px #b45309, inset 2px 2px 0px #fef08a'
                                    }}
                                >{letter}</div>
                            ))}
                        </div>

                        {/* Segunda linha do slogan */}
                        <div className="text-center mb-4 md:mb-8 relative z-10">
                            <p 
                                className="pixel-font text-xs md:text-sm text-white mt-2 md:mt-4"
                                style={{
                                    textShadow: '2px 2px 0px #1e3a5f',
                                    animation: 'fadeInOut 3s ease-in-out infinite'
                                }}
                            >
                                APRENDENDO PARA A VIDA
                            </p>
                        </div>

                        {/* Bot√£o Start estilo 16-bit */}
                        <button 
                            onClick={async () => {
                                await initAudio();
                                playSound('start');
                                setScreen('mode');
                            }} 
                            className="relative z-10 bg-gradient-to-b from-red-500 to-red-700 text-white font-bold py-3 px-6 md:py-4 md:px-8 rounded-lg border-4 border-red-300 pixel-font text-sm md:text-lg shadow-lg hover:from-red-400 hover:to-red-600 transition-all mb-3 md:mb-4 active:scale-95"
                            style={{
                                boxShadow: '0 6px 0px #7f1d1d, 0 8px 10px rgba(0,0,0,0.3)',
                                animation: 'buttonPulse 1.5s ease-in-out infinite'
                            }}
                        >
                            PRESS START
                        </button>

                        {/* Bot√£o Ranking */}
                        <button 
                            onClick={async () => {
                                await initAudio();
                                playSound('select');
                                setScreen('ranking');
                            }} 
                            className="relative z-10 bg-gradient-to-b from-yellow-500 to-yellow-700 text-white font-bold py-2 px-4 md:py-3 md:px-6 rounded-lg border-4 border-yellow-300 pixel-font text-xs md:text-sm shadow-lg hover:from-yellow-400 hover:to-yellow-600 transition-all mb-12 md:mb-16 active:scale-95"
                            style={{
                                boxShadow: '0 4px 0px #92400e, 0 6px 8px rgba(0,0,0,0.3)'
                            }}
                        >
                            üèÜ RANKING
                        </button>

                        {/* Cr√©dito */}
                        <div className="relative z-20 text-center mb-2 md:mb-4">
                            <p className="text-xs pixel-font text-blue-200 opacity-70">¬© 2025 QUIZ EDUCATIVO</p>
                            <p className="text-xs pixel-font text-blue-200 opacity-60 mt-1" style={{fontSize: '8px'}}>por M. Dancini, Claude IA, GPT e GEMINI</p>
                        </div>

                        {/* Colinas no fundo */}
                        <div className="absolute bottom-8 left-0 right-0 z-0">
                            <svg viewBox="0 0 400 60" className="w-full h-10 opacity-40">
                                <ellipse cx="50" cy="60" rx="80" ry="40" fill="#166534"/>
                                <ellipse cx="150" cy="60" rx="60" ry="30" fill="#15803d"/>
                                <ellipse cx="280" cy="60" rx="90" ry="45" fill="#166534"/>
                                <ellipse cx="380" cy="60" rx="70" ry="35" fill="#15803d"/>
                            </svg>
                        </div>

                        {/* Ch√£o estilo Mario World com blocos */}
                        <div className="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-b from-green-500 to-green-700 border-t-4 border-green-400 z-10">
                            <div className="flex justify-center gap-0 h-full">
                                {[...Array(30)].map((_, i) => (
                                    <div 
                                        key={i} 
                                        className="w-6 h-full border-r border-green-600"
                                        style={{
                                            background: i % 2 === 0 
                                                ? 'linear-gradient(to bottom, #22c55e 0%, #16a34a 50%, #15803d 100%)' 
                                                : 'linear-gradient(to bottom, #16a34a 0%, #15803d 50%, #166534 100%)'
                                        }}
                                    ></div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'mode') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-indigo-900 via-purple-800 to-purple-600 p-4 flex flex-col items-center justify-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Elementos decorativos */}
                        <div className="absolute top-10 left-10 text-5xl opacity-60" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>‚≠ê</div>
                        <div className="absolute top-20 right-16 text-4xl opacity-40" style={{animation: 'floatCloud 3s ease-in-out infinite reverse'}}>‚≠ê</div>
                        <div className="absolute bottom-32 left-16 text-3xl opacity-50" style={{animation: 'floatCloud 5s ease-in-out infinite'}}>üåô</div>

                        <h2 className="text-2xl md:text-3xl text-white pixel-font mb-4 text-center drop-shadow-lg">SELECIONE O</h2>
                        <h2 className="text-3xl md:text-4xl text-yellow-400 pixel-font mb-12 text-center drop-shadow-lg">MODO DE JOGO</h2>
                        
                        <div className="flex flex-col md:flex-row gap-6 mb-8">
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setGameMode('1P'); 
                                    setScreen('education'); 
                                }} 
                                className="bg-red-500 hover:bg-red-600 text-white p-8 rounded-xl border-4 border-red-300 pixel-font text-lg hover:scale-110 transition-all shadow-2xl flex flex-col items-center gap-4"
                            >
                                <span className="text-6xl">üë§</span>
                                <span>1 JOGADOR</span>
                                <span className="text-xs text-red-200">MODO SOLO</span>
                            </button>
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setGameMode('2P'); 
                                    setScreen('education'); 
                                }} 
                                className="bg-green-500 hover:bg-green-600 text-white p-8 rounded-xl border-4 border-green-300 pixel-font text-lg hover:scale-110 transition-all shadow-2xl flex flex-col items-center gap-4"
                            >
                                <span className="text-6xl">üë•</span>
                                <span>2 JOGADORES</span>
                                <span className="text-xs text-green-200">MODO VERSUS</span>
                            </button>
                        </div>

                        <button 
                            onClick={() => { playSound('select'); setScreen('prestart'); }}
                            className="text-white pixel-font text-sm hover:text-yellow-400 transition-colors"
                        >
                            ‚Üê VOLTAR
                        </button>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-purple-900 border-t-4 border-purple-950"></div>
                    </div>
                );
            }

            // TELA DE SELE√á√ÉO DE N√çVEL DE ENSINO
            if (screen === 'education') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-cyan-600 via-blue-600 to-indigo-700 p-4 flex flex-col items-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Elementos decorativos */}
                        <div className="absolute top-10 left-5 text-4xl opacity-60" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>üìö</div>
                        <div className="absolute top-20 right-10 text-5xl opacity-40" style={{animation: 'floatCloud 3s ease-in-out infinite reverse'}}>üéì</div>
                        <div className="absolute bottom-32 right-16 text-3xl opacity-50" style={{animation: 'floatCloud 5s ease-in-out infinite'}}>‚úèÔ∏è</div>

                        <h2 className="text-xl md:text-2xl text-white pixel-font mb-2 text-center drop-shadow-lg mt-4">SELECIONE O</h2>
                        <h2 className="text-2xl md:text-3xl text-yellow-400 pixel-font mb-6 text-center drop-shadow-lg">N√çVEL DE ENSINO</h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl w-full px-4 relative z-10">
                            {/* Educa√ß√£o Infantil */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('infantil');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-pink-500 hover:bg-pink-600 text-white p-4 rounded-xl border-4 border-pink-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üßí</span>
                                <div className="text-left">
                                    <div>EDUCA√á√ÉO INFANTIL</div>
                                    <div className="text-xs text-pink-200">4 a 5 anos</div>
                                </div>
                            </button>

                            {/* Fundamental 1 */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('fundamental1');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-orange-500 hover:bg-orange-600 text-white p-4 rounded-xl border-4 border-orange-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üë¶</span>
                                <div className="text-left">
                                    <div>FUNDAMENTAL I</div>
                                    <div className="text-xs text-orange-200">1¬∫ ao 5¬∫ ano</div>
                                </div>
                            </button>

                            {/* Fundamental 2 */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('fundamental2');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-green-500 hover:bg-green-600 text-white p-4 rounded-xl border-4 border-green-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üßë</span>
                                <div className="text-left">
                                    <div>FUNDAMENTAL II</div>
                                    <div className="text-xs text-green-200">6¬∫ ao 9¬∫ ano</div>
                                </div>
                            </button>

                            {/* Ensino M√©dio */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('medio');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-xl border-4 border-blue-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üë®‚Äçüéì</span>
                                <div className="text-left">
                                    <div>ENSINO M√âDIO</div>
                                    <div className="text-xs text-blue-200">1¬∫ ao 3¬∫ ano</div>
                                </div>
                            </button>

                            {/* Ensino Superior */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('superior');
                                    setScreen('superior_config'); 
                                }} 
                                className="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-xl border-4 border-purple-400 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3 md:col-span-2"
                            >
                                <span className="text-4xl">üéì</span>
                                <div className="text-left">
                                    <div>ENSINO SUPERIOR</div>
                                    <div className="text-xs text-purple-200">Gradua√ß√£o / P√≥s-gradua√ß√£o</div>
                                </div>
                            </button>
                        </div>

                        <button 
                            onClick={() => { playSound('select'); setScreen('mode'); }}
                            className="text-white pixel-font text-sm hover:text-yellow-400 transition-colors mt-6 relative z-10"
                        >
                            ‚Üê VOLTAR
                        </button>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-indigo-900 border-t-4 border-indigo-950"></div>
                    </div>
                );
            }

            // TELA DE CONFIGURA√á√ÉO DO ENSINO SUPERIOR
            if (screen === 'superior_config') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-purple-900 via-purple-700 to-indigo-800 p-4 flex flex-col items-center fade-in justify-center relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Elementos decorativos */}
                        <div className="absolute top-10 left-10 text-5xl opacity-40" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>üéì</div>
                        <div className="absolute top-20 right-16 text-4xl opacity-30" style={{animation: 'floatCloud 3s ease-in-out infinite reverse'}}>üìñ</div>

                        <div className="bg-white p-6 md:p-8 rounded-xl border-4 border-purple-400 shadow-2xl max-w-md w-full relative z-10">
                            <div className="flex justify-center mb-4">
                                <span className="text-5xl">üéì</span>
                            </div>
                            <h2 className="text-lg md:text-xl mb-6 pixel-font text-center text-purple-800">ENSINO SUPERIOR</h2>
                            
                            <div className="mb-4">
                                <label className="block pixel-font text-xs mb-2 text-purple-600">üìö CURSO:</label>
                                <input 
                                    type="text" 
                                    value={course} 
                                    onChange={(e) => setCourse(e.target.value)} 
                                    placeholder="Ex: Direito, Medicina, Engenharia..."
                                    className="w-full p-3 border-4 border-purple-300 rounded-lg pixel-font text-sm focus:border-purple-500 outline-none transition-colors"
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block pixel-font text-xs mb-2 text-blue-600">üìù CONTE√öDO/DISCIPLINA:</label>
                                <input 
                                    type="text" 
                                    value={subject} 
                                    onChange={(e) => setSubject(e.target.value)} 
                                    placeholder="Ex: Direito Constitucional, Anatomia..."
                                    className="w-full p-3 border-4 border-blue-300 rounded-lg pixel-font text-sm focus:border-blue-500 outline-none transition-colors"
                                />
                            </div>

                            {errorMsg && <div className="text-red-500 text-xs mb-4 pixel-font text-center bg-red-100 p-2 rounded">{errorMsg}</div>}

                            <button 
                                onClick={() => {
                                    if (!course.trim()) {
                                        setErrorMsg('Por favor, digite o nome do curso!');
                                        return;
                                    }
                                    if (!subject.trim()) {
                                        setErrorMsg('Por favor, digite o conte√∫do/disciplina!');
                                        return;
                                    }
                                    setErrorMsg('');
                                    playSound('select');
                                    setScreen('config');
                                }} 
                                className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-lg border-4 border-purple-800 pixel-font hover:scale-105 transition-transform shadow-lg"
                            >
                                CONTINUAR ‚Üí
                            </button>

                            <button 
                                onClick={() => { playSound('select'); setScreen('education'); }}
                                className="w-full mt-3 text-gray-500 pixel-font text-xs hover:text-gray-800 transition-colors"
                            >
                                ‚Üê VOLTAR
                            </button>
                        </div>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-purple-950 border-t-4 border-black"></div>
                    </div>
                );
            }

            if (screen === 'config') {
                const educationLabels = {
                    'infantil': { icon: 'üßí', name: 'Educa√ß√£o Infantil', color: 'pink' },
                    'fundamental1': { icon: 'üë¶', name: 'Fundamental I', color: 'orange' },
                    'fundamental2': { icon: 'üßë', name: 'Fundamental II', color: 'green' },
                    'medio': { icon: 'üë®‚Äçüéì', name: 'Ensino M√©dio', color: 'blue' },
                    'superior': { icon: 'üéì', name: `Superior - ${course}`, color: 'purple' }
                };
                const currentEdu = educationLabels[educationLevel] || { icon: 'üìö', name: 'Geral', color: 'gray' };

                return (
                    <div className="min-h-screen bg-gradient-to-b from-sky-400 via-sky-300 to-green-400 p-4 flex flex-col items-center fade-in justify-center relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Nuvens */}
                        <div className="absolute top-5 left-5 text-5xl opacity-70" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>‚òÅÔ∏è</div>
                        <div className="absolute top-16 right-10 text-7xl opacity-50" style={{animation: 'floatCloud 5s ease-in-out infinite reverse'}}>‚òÅÔ∏è</div>
                        
                        {/* Canos decorativos */}
                        <div className="absolute bottom-0 left-10 w-16 h-24 bg-green-600 border-4 border-green-800 rounded-t-lg"></div>
                        <div className="absolute bottom-0 right-10 w-16 h-32 bg-green-600 border-4 border-green-800 rounded-t-lg"></div>

                        <div className="bg-white p-6 md:p-8 rounded-xl border-4 border-black shadow-2xl max-w-md w-full relative z-10">
                            {/* Indicador do n√≠vel de ensino */}
                            <div className={`bg-${currentEdu.color}-100 border-2 border-${currentEdu.color}-400 rounded-lg p-2 mb-4 flex items-center justify-center gap-2`} style={{backgroundColor: currentEdu.color === 'pink' ? '#fce7f3' : currentEdu.color === 'orange' ? '#ffedd5' : currentEdu.color === 'green' ? '#dcfce7' : currentEdu.color === 'blue' ? '#dbeafe' : '#f3e8ff'}}>
                                <span className="text-2xl">{currentEdu.icon}</span>
                                <span className="pixel-font text-xs text-gray-700">{currentEdu.name}</span>
                            </div>

                            <div className="flex justify-center mb-4">
                                <span className="text-4xl">{gameMode === '1P' ? 'üë§' : 'üë•'}</span>
                            </div>
                            <h2 className="text-xl md:text-2xl mb-6 pixel-font text-center text-gray-800">CONFIGURA√á√ÉO</h2>
                            
                            <div className="mb-4">
                                <label className="block pixel-font text-xs mb-2 text-red-600">üî¥ JOGADOR 1:</label>
                                <input 
                                    type="text" 
                                    value={player1Name} 
                                    onChange={(e) => setPlayer1Name(e.target.value)} 
                                    className="w-full p-3 border-4 border-gray-300 rounded-lg pixel-font focus:border-red-500 outline-none transition-colors"
                                />
                            </div>

                            {gameMode === '2P' && (
                                <div className="mb-4">
                                    <label className="block pixel-font text-xs mb-2 text-green-600">üü¢ JOGADOR 2:</label>
                                    <input 
                                        type="text" 
                                        value={player2Name} 
                                        onChange={(e) => setPlayer2Name(e.target.value)} 
                                        className="w-full p-3 border-4 border-gray-300 rounded-lg pixel-font focus:border-green-500 outline-none transition-colors"
                                    />
                                </div>
                            )}

                            {/* Campo de mat√©ria - s√≥ mostra se n√£o for ensino superior (j√° preencheu antes) */}
                            {educationLevel !== 'superior' && (
                                <div className="mb-4">
                                    <label className="block pixel-font text-xs mb-2 text-blue-600">üìö MAT√âRIA:</label>
                                    <input 
                                        type="text" 
                                        value={subject} 
                                        onChange={(e) => setSubject(e.target.value)} 
                                        placeholder={educationLevel === 'infantil' ? 'Ex: Cores, N√∫meros, Animais...' : educationLevel === 'fundamental1' ? 'Ex: Matem√°tica, Portugu√™s...' : 'Ex: Hist√≥ria, Geografia, Ci√™ncias...'}
                                        className="w-full p-3 border-4 border-blue-300 rounded-lg pixel-font text-sm focus:border-blue-500 outline-none transition-colors"
                                    />
                                </div>
                            )}

                            {/* Mostra curso e conte√∫do se for ensino superior */}
                            {educationLevel === 'superior' && (
                                <div className="mb-4 bg-purple-50 p-3 rounded-lg border-2 border-purple-200">
                                    <p className="pixel-font text-xs text-purple-600 mb-1">üìö Curso: {course}</p>
                                    <p className="pixel-font text-xs text-purple-600">üìù Conte√∫do: {subject}</p>
                                </div>
                            )}

                            <div className="mb-6">
                                <label className="block pixel-font text-xs mb-2 text-purple-600">‚ö° DIFICULDADE:</label>
                                <div className="flex gap-2">
                                    <button 
                                        type="button"
                                        onClick={() => { playSound('select'); setDifficulty('facil'); }}
                                        className={`flex-1 p-3 rounded-lg border-4 pixel-font text-xs transition-all ${difficulty === 'facil' ? 'bg-green-500 text-white border-green-700 scale-105' : 'bg-gray-100 border-gray-300 hover:bg-green-100'}`}
                                    >
                                        üòä<br/>F√ÅCIL
                                    </button>
                                    <button 
                                        type="button"
                                        onClick={() => { playSound('select'); setDifficulty('medio'); }}
                                        className={`flex-1 p-3 rounded-lg border-4 pixel-font text-xs transition-all ${difficulty === 'medio' ? 'bg-yellow-500 text-white border-yellow-700 scale-105' : 'bg-gray-100 border-gray-300 hover:bg-yellow-100'}`}
                                    >
                                        üòê<br/>M√âDIO
                                    </button>
                                    <button 
                                        type="button"
                                        onClick={() => { playSound('select'); setDifficulty('dificil'); }}
                                        className={`flex-1 p-3 rounded-lg border-4 pixel-font text-xs transition-all ${difficulty === 'dificil' ? 'bg-red-500 text-white border-red-700 scale-105' : 'bg-gray-100 border-gray-300 hover:bg-red-100'}`}
                                    >
                                        üòà<br/>DIF√çCIL
                                    </button>
                                </div>
                            </div>

                            {errorMsg && <div className="text-red-500 text-xs mb-4 pixel-font text-center bg-red-100 p-2 rounded">{errorMsg}</div>}

                            <button 
                                onClick={startGame} 
                                className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-lg border-4 border-green-700 pixel-font hover:scale-105 transition-transform shadow-lg"
                            >
                                üéÆ INICIAR AVENTURA!
                            </button>

                            <button 
                                onClick={() => { playSound('select'); setScreen(educationLevel === 'superior' ? 'superior_config' : 'education'); }}
                                className="w-full mt-3 text-gray-500 pixel-font text-xs hover:text-gray-800 transition-colors"
                            >
                                ‚Üê VOLTAR
                            </button>
                        </div>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-green-600 border-t-8 border-green-700"></div>
                    </div>
                );
            }

            if (screen === 'question') {
                const pName = currentPlayer === 1 ? player1Name : player2Name;
                
                // Emoji do personagem baseado no n√≠vel de ensino
                const getCharacterEmoji = () => {
                    if (characterMood === 'sad') return 'üò¢';
                    if (characterMood === 'happy') return 'üéâ';
                    
                    const emojis = {
                        'infantil': ['üßí', 'üëß', 'üêª', 'ü¶Å', 'üê∞'],
                        'fundamental1': ['üë¶', 'üëß', 'üìö', '‚úèÔ∏è', 'üéí'],
                        'fundamental2': ['üßë', 'üë©', 'üìñ', 'üî¨', 'üåç'],
                        'medio': ['üë®‚Äçüéì', 'üë©‚Äçüéì', 'üìê', 'üß™', 'üí°'],
                        'superior': ['üéì', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üìä', 'üî¨']
                    };
                    const levelEmojis = emojis[educationLevel] || ['üòä'];
                    return levelEmojis[currentQIndex % levelEmojis.length];
                };

                // Emojis tem√°ticos para perguntas infantis
                const getThemeEmoji = () => {
                    if (educationLevel !== 'infantil') return null;
                    
                    const perguntaLower = currentQuestion?.pergunta?.toLowerCase() || '';
                    
                    // Mapeia palavras-chave para emojis
                    const emojiMap = {
                        'cor': 'üé®', 'cores': 'üåà', 'vermelho': 'üî¥', 'azul': 'üîµ', 'amarelo': 'üü°', 'verde': 'üü¢',
                        'animal': 'üêæ', 'cachorro': 'üêï', 'gato': 'üê±', 'p√°ssaro': 'üê¶', 'peixe': 'üêü', 'le√£o': 'ü¶Å',
                        'elefante': 'üêò', 'macaco': 'üêµ', 'coelho': 'üê∞', 'urso': 'üêª', 'girafa': 'ü¶í', 'zebra': 'ü¶ì',
                        'fruta': 'üçé', 'ma√ß√£': 'üçé', 'banana': 'üçå', 'laranja': 'üçä', 'uva': 'üçá', 'morango': 'üçì',
                        'n√∫mero': 'üî¢', 'contar': 'üî¢', 'quantos': 'üî¢', 'quanto': 'üî¢',
                        'fam√≠lia': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'mam√£e': 'üë©', 'papai': 'üë®', 'irm√£o': 'üë¶', 'irm√£': 'üëß', 'vov√≥': 'üëµ', 'vov√¥': 'üë¥',
                        'casa': 'üè†', 'escola': 'üè´', 'parque': 'üèûÔ∏è',
                        'sol': '‚òÄÔ∏è', 'lua': 'üåô', 'estrela': '‚≠ê', 'chuva': 'üåßÔ∏è', 'nuvem': '‚òÅÔ∏è',
                        'carro': 'üöó', '√¥nibus': 'üöå', 'avi√£o': '‚úàÔ∏è', 'barco': 'üö¢', 'bicicleta': 'üö≤',
                        'bola': '‚öΩ', 'boneca': 'ü™Ü', 'brinquedo': 'üß∏',
                        'comida': 'üçΩÔ∏è', 'p√£o': 'üçû', 'leite': 'ü•õ', 'ovo': 'ü•ö',
                        '√°rvore': 'üå≥', 'flor': 'üå∏', 'folha': 'üçÉ',
                        'cora√ß√£o': '‚ù§Ô∏è', 'm√£o': '‚úã', 'p√©': 'ü¶∂', 'olho': 'üëÅÔ∏è', 'boca': 'üëÑ',
                    };
                    
                    for (const [palavra, emoji] of Object.entries(emojiMap)) {
                        if (perguntaLower.includes(palavra)) {
                            return emoji;
                        }
                    }
                    
                    // Emojis gen√©ricos para infantil
                    const genericEmojis = ['üåü', 'üéà', 'üéÄ', 'üåª', 'ü¶ã', 'üêù', 'üå∫'];
                    return genericEmojis[Math.floor(Math.random() * genericEmojis.length)];
                };
                
                return (
                    <div className="min-h-screen bg-gradient-to-b from-sky-300 to-sky-100 p-4">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />

                        {/* Notifica√ß√£o de vida extra */}
                        {showBonusLife && (
                            <div className="fixed top-1/4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-4 rounded-xl border-4 border-green-700 pixel-font text-center z-50 animate-bounce shadow-2xl">
                                <div className="text-3xl mb-2">‚ù§Ô∏è +1</div>
                                <div className="text-sm">VIDA EXTRA!</div>
                                <div className="text-xs mt-1">3 acertos seguidos!</div>
                            </div>
                        )}

                        {/* Placar */}
                        <div className="bg-black text-white p-2 md:p-3 rounded-lg border-2 md:border-4 border-white mb-2 md:mb-4 pixel-font text-xs flex justify-between items-center">
                            <div className={`${currentPlayer === 1 ? "text-yellow-400" : "text-gray-500"} truncate max-w-[40%]`}>
                                üî¥ {player1Name.substring(0, 6)}: {player1Score}
                                <span className="hidden md:inline"> {Array(Math.max(0, player1Lives)).fill('‚ù§Ô∏è').join('')}</span>
                                <span className="md:hidden"> {player1Lives}‚ù§Ô∏è</span>
                                {player1Streak > 0 && <span className="text-orange-400 ml-1">üî•{player1Streak}</span>}
                            </div>
                            <div className="text-center">
                                <span className="text-white">#{currentQIndex + 1}</span>
                            </div>
                            {gameMode === '2P' && (
                                <div className={`${currentPlayer === 2 ? "text-yellow-400" : "text-gray-500"} truncate max-w-[40%] text-right`}>
                                    üü¢ {player2Name.substring(0, 6)}: {player2Score}
                                    <span className="hidden md:inline"> {Array(Math.max(0, player2Lives)).fill('‚ù§Ô∏è').join('')}</span>
                                    <span className="md:hidden"> {player2Lives}‚ù§Ô∏è</span>
                                    {player2Streak > 0 && <span className="text-orange-400 ml-1">üî•{player2Streak}</span>}
                                </div>
                            )}
                        </div>
                        {/* Personagem */}
                        <div className="flex justify-center items-end h-24 md:h-32 mb-2 md:mb-4 relative border-b-4 md:border-b-8 border-green-700 bg-sky-200 rounded-lg overflow-hidden">
                            <div className="absolute top-2 left-5 md:left-10 text-2xl md:text-4xl opacity-80" style={{animation: 'floatCloud 3s ease-in-out infinite'}}>‚òÅÔ∏è</div>
                            <div className="flex flex-col items-center z-10">
                                {isLoading && <div className="speech-bubble mb-1 md:mb-2 text-xs">Pensando<span className="loading-dots"></span></div>}
                                {!isLoading && characterMood === 'happy' && <div className="speech-bubble mb-1 md:mb-2 text-xs">Muito bem! üéâ</div>}
                                {!isLoading && characterMood === 'sad' && <div className="speech-bubble mb-1 md:mb-2 text-xs">N√£o foi dessa vez...</div>}
                                <div className={`character-container character-${characterMood}`} style={{fontSize: '40px'}}>
                                    {getCharacterEmoji()}
                                </div>
                            </div>
                        </div>

                        {/* Pergunta */}
                        <div className="max-w-2xl mx-auto px-1 md:px-0">
                            {!showExplanation && currentQuestion && !isLoading ? (
                                <>
                                    <div className="bg-yellow-100 border-2 md:border-4 border-yellow-600 p-3 md:p-4 rounded-lg mb-2 md:mb-4 shadow-lg">
                                        <div className="pixel-font text-xs text-blue-600 mb-1 md:mb-2">
                                            {gameMode === '2P' ? `VEZ DE: ${pName}` : subject.toUpperCase()}
                                        </div>
                                        
                                        <p className={`font-bold font-sans ${educationLevel === 'infantil' ? 'text-lg md:text-xl text-center' : 'text-base md:text-lg'}`}>
                                            {currentQuestion.pergunta}
                                        </p>
                                    </div>
                                    <div className="grid grid-cols-1 gap-2">
                                        {Object.entries(currentQuestion.alternativas).map(([key, value]) => (
                                            <button 
                                                key={key} 
                                                onClick={() => handleAnswer(key)} 
                                                className={`bg-white hover:bg-blue-100 active:bg-blue-200 text-left p-2 md:p-3 rounded-lg border-b-4 border-gray-300 font-bold flex items-center ${educationLevel === 'infantil' ? 'text-base md:text-lg' : 'text-sm md:text-base'} active:scale-98 transition-transform`}
                                            >
                                                <span className="bg-blue-600 text-white w-7 h-7 md:w-8 md:h-8 flex items-center justify-center rounded mr-2 md:mr-3 text-sm md:text-base flex-shrink-0">{key}</span>
                                                <span className="break-words">{value}</span>
                                            </button>
                                        ))}
                                    </div>
                                </>
                            ) : showExplanation ? (
                                <div className={`p-4 md:p-6 rounded-lg border-4 text-center shadow-2xl ${explanationData.correct ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'}`}>
                                    <div className="text-4xl md:text-5xl mb-2 md:mb-3">{explanationData.correct ? '‚≠ê' : 'üò¢'}</div>
                                    <h2 className="text-xl md:text-2xl font-bold mb-2 md:mb-4 pixel-font">{explanationData.correct ? 'CORRETO!' : 'ERROU!'}</h2>
                                    <p className="text-sm md:text-lg mb-4 md:mb-6">{explanationData.text}</p>
                                    <button onClick={nextStep} className="bg-black text-white px-6 md:px-8 py-2 md:py-3 rounded pixel-font text-sm md:text-base active:scale-95">CONTINUAR ‚û§</button>
                                </div>
                            ) : null}
                            
                            {errorMsg && <div className="text-center text-red-600 pixel-font text-xs mt-2">{errorMsg}</div>}
                        </div>
                    </div>
                );
            }

            if (screen === 'gameover') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black flex flex-col items-center justify-center text-white p-4 fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* Estrelas de fundo */}
                        <div className="absolute inset-0 overflow-hidden">
                            {[...Array(30)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-yellow-300"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 100}%`,
                                        animation: `twinkle ${1 + Math.random() * 2}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`,
                                        fontSize: `${Math.random() * 8 + 4}px`
                                    }}
                                >‚òÖ</div>
                            ))}
                        </div>

                        <div className="relative z-10 flex flex-col items-center">
                            <h1 className="text-4xl md:text-6xl text-red-500 pixel-font mb-8 text-center" style={{textShadow: '4px 4px 0px #000'}}>
                                GAME OVER
                            </h1>
                            
                            <div className="flex flex-col gap-4">
                                <button 
                                    onClick={() => { playSound('select'); setScreen('prestart'); }} 
                                    className="bg-white hover:bg-gray-100 text-black px-8 py-4 rounded-lg border-4 border-gray-400 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üè† MENU INICIAL
                                </button>
                                <button 
                                    onClick={() => { 
                                        playSound('select'); 
                                        // Salvar no ranking antes de ir
                                        if (gameMode === '1P') {
                                            saveToRanking(player1Name, player1Score);
                                        } else {
                                            saveToRanking(player1Name, player1Score);
                                            saveToRanking(player2Name, player2Score);
                                        }
                                        setScreen('ranking'); 
                                    }} 
                                    className="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-4 rounded-lg border-4 border-yellow-600 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üèÜ VER RANKING
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA DE RANKING
            if (screen === 'ranking') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-yellow-600 via-yellow-500 to-orange-500 p-4 flex flex-col items-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* Estrelas decorativas */}
                        <div className="absolute inset-0 overflow-hidden">
                            {[...Array(20)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-yellow-200"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 100}%`,
                                        animation: `twinkle ${1 + Math.random() * 2}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`,
                                        fontSize: `${Math.random() * 15 + 10}px`
                                    }}
                                >‚≠ê</div>
                            ))}
                        </div>

                        <div className="relative z-10 w-full max-w-2xl">
                            {/* T√≠tulo */}
                            <div className="text-center mb-6 mt-4">
                                <div className="text-6xl mb-2">üèÜ</div>
                                <h1 className="text-2xl md:text-4xl text-white pixel-font" style={{textShadow: '3px 3px 0px #92400e'}}>
                                    RANKING
                                </h1>
                                <p className="text-yellow-200 pixel-font text-xs mt-2">TOP 10 JOGADORES</p>
                            </div>

                            {/* Tabela de Ranking */}
                            <div className="bg-white rounded-xl border-4 border-yellow-800 shadow-2xl overflow-hidden">
                                {/* Cabe√ßalho */}
                                <div className="bg-yellow-800 text-white p-3 pixel-font text-xs grid grid-cols-12 gap-1">
                                    <div className="col-span-1 text-center">#</div>
                                    <div className="col-span-2">NOME</div>
                                    <div className="col-span-3">MAT√âRIA</div>
                                    <div className="col-span-2">N√çVEL</div>
                                    <div className="col-span-2">DIFIC.</div>
                                    <div className="col-span-2 text-right">PTS</div>
                                </div>

                                {/* Lista */}
                                <div className="max-h-80 overflow-y-auto">
                                    {ranking.length === 0 ? (
                                        <div className="p-8 text-center text-gray-500 pixel-font text-xs">
                                            Nenhum jogador ainda.<br/>Seja o primeiro! üéÆ
                                        </div>
                                    ) : (
                                        ranking.map((entry, index) => (
                                            <div 
                                                key={entry.id} 
                                                className={`p-3 pixel-font text-xs grid grid-cols-12 gap-1 items-center border-b border-gray-200 ${
                                                    index === 0 ? 'bg-yellow-100' : 
                                                    index === 1 ? 'bg-gray-100' : 
                                                    index === 2 ? 'bg-orange-50' : 'bg-white'
                                                }`}
                                            >
                                                <div className="col-span-1 text-center font-bold">
                                                    {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`}
                                                </div>
                                                <div className="col-span-2 truncate font-bold text-gray-800">
                                                    {entry.name}
                                                </div>
                                                <div className="col-span-3 truncate text-blue-600">
                                                    {entry.course ? `${entry.course}: ${entry.subject}` : entry.subject}
                                                </div>
                                                <div className="col-span-2 text-purple-600">
                                                    {getEducationLabel(entry.educationLevel)}
                                                </div>
                                                <div className="col-span-2">
                                                    {getDifficultyLabel(entry.difficulty)}
                                                </div>
                                                <div className="col-span-2 text-right font-bold text-green-600">
                                                    {entry.score}
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>

                            {/* Bot√µes */}
                            <div className="flex flex-col md:flex-row gap-4 mt-6 justify-center">
                                <button 
                                    onClick={() => { playSound('select'); setScreen('prestart'); }} 
                                    className="bg-white hover:bg-gray-100 text-yellow-800 px-6 py-3 rounded-lg border-4 border-yellow-800 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üè† MENU
                                </button>
                                {ranking.length > 0 && (
                                    <button 
                                        onClick={clearRanking} 
                                        className="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded-lg border-4 border-red-800 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                    >
                                        üóëÔ∏è LIMPAR
                                    </button>
                                )}
                                <button 
                                    onClick={() => { playSound('start'); setScreen('mode'); }} 
                                    className="bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg border-4 border-green-800 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üéÆ JOGAR
                                </button>
                            </div>

                            {/* Cr√©ditos */}
                            <div className="text-center mt-6">
                                <p className="text-yellow-900 pixel-font text-xs opacity-80">¬© 2025 QUIZ EDUCATIVO</p>
                                <p className="text-yellow-900 pixel-font text-xs opacity-60 mt-1">por M. Dancini, Claude IA, GPT e GEMINI</p>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA DE VIT√ìRIA (9999 pontos)
            if (screen === 'victory') {
                const winnerName = currentPlayer === 1 ? player1Name : player2Name;
                
                return (
                    <div className="min-h-screen bg-gradient-to-b from-yellow-400 via-orange-400 to-red-500 flex flex-col items-center justify-center text-white p-4 fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* Confetes animados */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            {[...Array(50)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-2xl"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `-20px`,
                                        animation: `confettiFall ${3 + Math.random() * 4}s linear infinite`,
                                        animationDelay: `${Math.random() * 3}s`
                                    }}
                                >{['üéâ', 'üéä', '‚≠ê', 'üåü', '‚ú®', 'üèÜ', 'üëë', 'üí´'][Math.floor(Math.random() * 8)]}</div>
                            ))}
                        </div>

                        {/* Fogos de artif√≠cio */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            {[...Array(10)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-4xl"
                                    style={{
                                        left: `${10 + Math.random() * 80}%`,
                                        top: `${10 + Math.random() * 40}%`,
                                        animation: `firework ${1 + Math.random() * 2}s ease-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`
                                    }}
                                >üéÜ</div>
                            ))}
                        </div>

                        <div className="relative z-10 flex flex-col items-center text-center">
                            <div className="text-8xl mb-4 animate-bounce">üèÜ</div>
                            
                            <h1 className="text-3xl md:text-5xl text-white pixel-font mb-4" style={{textShadow: '4px 4px 0px #c53030'}}>
                                PARAB√âNS!
                            </h1>
                            
                            <h2 className="text-xl md:text-3xl text-yellow-100 pixel-font mb-4" style={{textShadow: '2px 2px 0px #000'}}>
                                {winnerName}
                            </h2>
                            
                            <div className="bg-white text-black px-8 py-4 rounded-xl border-4 border-yellow-600 mb-6 shadow-2xl">
                                <p className="pixel-font text-lg mb-2">VOC√ä CHEGOU AO</p>
                                <p className="pixel-font text-4xl text-green-600 font-bold">FINAL DO JOGO!</p>
                                <p className="pixel-font text-2xl text-yellow-600 mt-2">9999 PONTOS</p>
                            </div>
                            
                            <p className="text-white pixel-font text-sm mb-8 max-w-md" style={{textShadow: '1px 1px 0px #000'}}>
                                Voc√™ demonstrou um conhecimento incr√≠vel! Continue assim e nunca pare de aprender!
                            </p>
                            
                            <div className="flex flex-col gap-4">
                                <button 
                                    onClick={() => { 
                                        playSound('select');
                                        saveToRanking(winnerName, 9999);
                                        setScreen('ranking'); 
                                    }} 
                                    className="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-4 rounded-lg border-4 border-yellow-700 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üèÜ VER RANKING
                                </button>
                                <button 
                                    onClick={() => { playSound('select'); setScreen('prestart'); }} 
                                    className="bg-white hover:bg-gray-100 text-black px-8 py-4 rounded-lg border-4 border-gray-400 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üè† MENU INICIAL
                                </button>
                            </div>
                            
                            {/* Cr√©ditos */}
                            <div className="text-center mt-8">
                                <p className="text-white pixel-font text-xs opacity-80" style={{textShadow: '1px 1px 0px #000'}}>¬© 2025 QUIZ EDUCATIVO</p>
                                <p className="text-white pixel-font text-xs opacity-60 mt-1" style={{textShadow: '1px 1px 0px #000'}}>por M. Dancini, Claude IA, GPT e GEMINI</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MarioQuizGame />);
    </script>
</body>
</html>
