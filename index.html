<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e40af">
    <title>Super Quiz Bros - Quiz Educativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            overflow-x: hidden;
            overscroll-behavior: none;
        }
        
        .pixel-font { font-family: 'Press Start 2P', monospace; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes walk {
            0% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            100% { transform: rotate(-5deg); }
        }

        @keyframes floatCloud {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-in; }
        .pulse { animation: pulse 1s infinite; }

        .character-container {
            font-size: 80px;
            filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.3));
            transition: all 0.3s;
        }
        .character-happy { animation: bounce 0.5s infinite; }
        .character-sad { filter: grayscale(100%); transform: scale(0.9); }
        .character-thinking { animation: walk 2s infinite; }

        .speech-bubble {
            position: relative;
            background: #fff;
            border: 4px solid #000;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            line-height: 1.5;
            color: #000;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            left: 20px;
            bottom: -14px;
            border: 7px solid transparent;
            border-top-color: #000;
        }

        .player-indicator { animation: pulse 1s infinite; }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        /* Anima√ß√µes estilo Super Mario World 16-bit */
        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.5); }
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes blockBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 6px 0px #7f1d1d, 0 8px 10px rgba(0,0,0,0.3); }
            50% { transform: scale(1.05); box-shadow: 0 4px 0px #7f1d1d, 0 6px 8px rgba(0,0,0,0.3); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        @keyframes confettiFall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes firework {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body class="m-0 p-0 bg-black">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURA√á√ïES ---
        // Open Trivia Database (gratuito, sem API key)
        const TRIVIA_API = "https://opentdb.com/api.php";
        // Lingva Translate (gratuito, sem API key)
        const TRANSLATE_API = "https://lingva.ml/api/v1/en/pt";

        // Cache de perguntas
        let perguntasUsadas = [];

        // Mapeamento de categorias do Trivia
        const triviaCategories = {
            // Categorias educacionais b√°sicas
            'matematica': 19,      // Science: Mathematics
            'ciencias': 17,        // Science & Nature
            'historia': 23,        // History
            'geografia': 22,       // Geography
            'animais': 27,         // Animals
            'artes': 25,           // Art
            'esportes': 21,        // Sports
            'geral': 9,            // General Knowledge
            'portugues': 9,        // General Knowledge
            'fisica': 17,          // Science & Nature
            'quimica': 17,         // Science & Nature
            'biologia': 17,        // Science & Nature
            'filosofia': 9,        // General Knowledge
            'sociologia': 9,       // General Knowledge
            'ingles': 9,           // General Knowledge
            
            // Categorias do Ensino Superior
            'direito': 9,          // General Knowledge (mais pr√≥ximo)
            'medicina': 17,        // Science & Nature
            'engenharia': 17,      // Science & Nature
            'administracao': 9,    // General Knowledge
            'psicologia': 9,       // General Knowledge
            'educacao': 9,         // General Knowledge
            'computacao': 18,      // Computers
            'economia': 9          // General Knowledge
        };

        // Mapeamento de dificuldade
        const triviadifficulty = {
            'facil': 'easy',
            'medio': 'medium',
            'dificil': 'hard'
        };

        // ==========================================
        // PERGUNTAS INFANTIS (fixas no c√≥digo)
        // ==========================================
        const perguntasInfantis = {
            cores: [
                { pergunta: "Qual √© a cor do c√©u?", alternativas: { A: "Verde", B: "Azul", C: "Vermelho", D: "Amarelo" }, correta: "B", explicacao: "O c√©u durante o dia √© azul!" },
                { pergunta: "Qual √© a cor do sol?", alternativas: { A: "Azul", B: "Verde", C: "Amarelo", D: "Roxo" }, correta: "C", explicacao: "O sol √© amarelo e brilhante!" },
                { pergunta: "Qual √© a cor da grama?", alternativas: { A: "Verde", B: "Azul", C: "Vermelho", D: "Laranja" }, correta: "A", explicacao: "A grama √© verde!" },
                { pergunta: "Qual √© a cor do morango?", alternativas: { A: "Amarelo", B: "Verde", C: "Vermelho", D: "Azul" }, correta: "C", explicacao: "O morango √© vermelho!" },
                { pergunta: "Qual √© a cor da banana?", alternativas: { A: "Vermelho", B: "Amarelo", C: "Roxo", D: "Verde" }, correta: "B", explicacao: "A banana madura √© amarela!" },
                { pergunta: "Qual √© a cor do chocolate?", alternativas: { A: "Branco", B: "Rosa", C: "Marrom", D: "Azul" }, correta: "C", explicacao: "O chocolate √© marrom!" },
                { pergunta: "Qual √© a cor da neve?", alternativas: { A: "Cinza", B: "Azul", C: "Branco", D: "Amarelo" }, correta: "C", explicacao: "A neve √© branca!" },
                { pergunta: "Qual √© a cor da laranja (fruta)?", alternativas: { A: "Laranja", B: "Azul", C: "Verde", D: "Rosa" }, correta: "A", explicacao: "A laranja tem a cor laranja!" },
                { pergunta: "Qual √© a cor do cora√ß√£o nos desenhos?", alternativas: { A: "Azul", B: "Verde", C: "Vermelho", D: "Preto" }, correta: "C", explicacao: "O cora√ß√£o √© desenhado em vermelho!" },
                { pergunta: "Qual √© a cor das nuvens?", alternativas: { A: "Verde", B: "Branco", C: "Vermelho", D: "Amarelo" }, correta: "B", explicacao: "As nuvens s√£o brancas!" },
                { pergunta: "Misturando azul e amarelo, que cor aparece?", alternativas: { A: "Vermelho", B: "Laranja", C: "Verde", D: "Roxo" }, correta: "C", explicacao: "Azul + amarelo = verde!" },
                { pergunta: "Misturando vermelho e amarelo, que cor aparece?", alternativas: { A: "Verde", B: "Laranja", C: "Roxo", D: "Azul" }, correta: "B", explicacao: "Vermelho + amarelo = laranja!" },
                { pergunta: "Qual √© a cor do Papai Noel?", alternativas: { A: "Azul", B: "Verde", C: "Vermelho", D: "Amarelo" }, correta: "C", explicacao: "O Papai Noel usa roupa vermelha!" },
                { pergunta: "Qual √© a cor do mar?", alternativas: { A: "Verde", B: "Azul", C: "Vermelho", D: "Amarelo" }, correta: "B", explicacao: "O mar √© azul!" },
                { pergunta: "Qual √© a cor da lua?", alternativas: { A: "Amarelo", B: "Branco", C: "Vermelho", D: "Azul" }, correta: "B", explicacao: "A lua √© branca ou amarelada!" }
            ],
            animais: [
                { pergunta: "Qual animal faz AU AU?", alternativas: { A: "Gato", B: "Cachorro", C: "P√°ssaro", D: "Peixe" }, correta: "B", explicacao: "O cachorro faz AU AU!" },
                { pergunta: "Qual animal faz MIAU?", alternativas: { A: "Cachorro", B: "Vaca", C: "Gato", D: "Porco" }, correta: "C", explicacao: "O gato faz MIAU!" },
                { pergunta: "Qual animal d√° leite?", alternativas: { A: "Galinha", B: "Peixe", C: "Vaca", D: "P√°ssaro" }, correta: "C", explicacao: "A vaca d√° leite!" },
                { pergunta: "Qual animal p√µe ovos e faz COCORIC√ì?", alternativas: { A: "Cachorro", B: "Galo", C: "Peixe", D: "Cavalo" }, correta: "B", explicacao: "O galo faz COCORIC√ì!" },
                { pergunta: "Qual animal tem tromba grande?", alternativas: { A: "Le√£o", B: "Macaco", C: "Elefante", D: "Girafa" }, correta: "C", explicacao: "O elefante tem tromba!" },
                { pergunta: "Qual animal √© o rei da selva?", alternativas: { A: "Tigre", B: "Le√£o", C: "Urso", D: "Lobo" }, correta: "B", explicacao: "O le√£o √© o rei da selva!" },
                { pergunta: "Qual animal pula e come cenoura?", alternativas: { A: "Cachorro", B: "Gato", C: "Coelho", D: "P√°ssaro" }, correta: "C", explicacao: "O coelho pula e come cenoura!" },
                { pergunta: "Qual animal vive na √°gua?", alternativas: { A: "Cachorro", B: "Peixe", C: "Gato", D: "P√°ssaro" }, correta: "B", explicacao: "O peixe vive na √°gua!" },
                { pergunta: "Qual animal tem pesco√ßo bem longo?", alternativas: { A: "Elefante", B: "Le√£o", C: "Girafa", D: "Urso" }, correta: "C", explicacao: "A girafa tem pesco√ßo longo!" },
                { pergunta: "Qual animal fazOINC OINC?", alternativas: { A: "Vaca", B: "Porco", C: "Galinha", D: "Pato" }, correta: "B", explicacao: "O porco faz OINC OINC!" },
                { pergunta: "Quantas patas tem um cachorro?", alternativas: { A: "2", B: "6", C: "4", D: "8" }, correta: "C", explicacao: "O cachorro tem 4 patas!" },
                { pergunta: "Qual animal voa?", alternativas: { A: "Peixe", B: "Cachorro", C: "P√°ssaro", D: "Gato" }, correta: "C", explicacao: "O p√°ssaro voa!" },
                { pergunta: "Qual animal faz MUU?", alternativas: { A: "Cavalo", B: "Vaca", C: "Porco", D: "Galinha" }, correta: "B", explicacao: "A vaca faz MUU!" },
                { pergunta: "Qual animal d√° mel?", alternativas: { A: "Formiga", B: "Abelha", C: "Borboleta", D: "Mosca" }, correta: "B", explicacao: "A abelha produz mel!" },
                { pergunta: "Qual animal rasteja e n√£o tem pernas?", alternativas: { A: "Lagarto", B: "Cobra", C: "Sapo", D: "Tartaruga" }, correta: "B", explicacao: "A cobra rasteja e n√£o tem pernas!" }
            ],
            numeros: [
                { pergunta: "Quantos dedos temos em uma m√£o?", alternativas: { A: "3", B: "4", C: "5", D: "6" }, correta: "C", explicacao: "Temos 5 dedos em cada m√£o!" },
                { pergunta: "Quanto √© 1 + 1?", alternativas: { A: "1", B: "2", C: "3", D: "4" }, correta: "B", explicacao: "1 + 1 = 2!" },
                { pergunta: "Quanto √© 2 + 2?", alternativas: { A: "2", B: "3", C: "4", D: "5" }, correta: "C", explicacao: "2 + 2 = 4!" },
                { pergunta: "Qual n√∫mero vem depois do 3?", alternativas: { A: "2", B: "4", C: "5", D: "1" }, correta: "B", explicacao: "Depois do 3 vem o 4!" },
                { pergunta: "Qual n√∫mero vem antes do 5?", alternativas: { A: "3", B: "4", C: "6", D: "7" }, correta: "B", explicacao: "Antes do 5 vem o 4!" },
                { pergunta: "Quantas pernas tem uma aranha?", alternativas: { A: "4", B: "6", C: "8", D: "10" }, correta: "C", explicacao: "A aranha tem 8 pernas!" },
                { pergunta: "Quanto √© 3 + 2?", alternativas: { A: "4", B: "5", C: "6", D: "7" }, correta: "B", explicacao: "3 + 2 = 5!" },
                { pergunta: "Quantos olhos voc√™ tem?", alternativas: { A: "1", B: "2", C: "3", D: "4" }, correta: "B", explicacao: "Temos 2 olhos!" },
                { pergunta: "Quanto √© 5 - 3?", alternativas: { A: "1", B: "2", C: "3", D: "4" }, correta: "B", explicacao: "5 - 3 = 2!" },
                { pergunta: "Quantos dias tem uma semana?", alternativas: { A: "5", B: "6", C: "7", D: "8" }, correta: "C", explicacao: "A semana tem 7 dias!" },
                { pergunta: "Quanto √© 4 + 1?", alternativas: { A: "3", B: "4", C: "5", D: "6" }, correta: "C", explicacao: "4 + 1 = 5!" },
                { pergunta: "Qual √© o menor: 3, 7 ou 5?", alternativas: { A: "3", B: "5", C: "7", D: "Todos iguais" }, correta: "A", explicacao: "3 √© o menor n√∫mero!" },
                { pergunta: "Quanto √© 10 - 5?", alternativas: { A: "3", B: "4", C: "5", D: "6" }, correta: "C", explicacao: "10 - 5 = 5!" },
                { pergunta: "Quantas rodas tem um carro?", alternativas: { A: "2", B: "3", C: "4", D: "5" }, correta: "C", explicacao: "O carro tem 4 rodas!" },
                { pergunta: "Quanto √© 1 + 2 + 3?", alternativas: { A: "4", B: "5", C: "6", D: "7" }, correta: "C", explicacao: "1 + 2 + 3 = 6!" }
            ],
            familia: [
                { pergunta: "Quem √© a m√£e do seu pai?", alternativas: { A: "Tia", B: "Av√≥", C: "Prima", D: "Irm√£" }, correta: "B", explicacao: "A m√£e do seu pai √© sua av√≥!" },
                { pergunta: "Quem √© o filho da sua tia?", alternativas: { A: "Irm√£o", B: "Tio", C: "Primo", D: "Av√¥" }, correta: "C", explicacao: "O filho da tia √© seu primo!" },
                { pergunta: "O que a mam√£e √© do papai?", alternativas: { A: "Filha", B: "Irm√£", C: "Esposa", D: "Prima" }, correta: "C", explicacao: "A mam√£e √© esposa do papai!" },
                { pergunta: "Quem √© o pai da sua m√£e?", alternativas: { A: "Tio", B: "Av√¥", C: "Primo", D: "Irm√£o" }, correta: "B", explicacao: "O pai da sua m√£e √© seu av√¥!" },
                { pergunta: "O irm√£o do seu pai √© seu...", alternativas: { A: "Primo", B: "Av√¥", C: "Tio", D: "Sobrinho" }, correta: "C", explicacao: "O irm√£o do pai √© o tio!" },
                { pergunta: "A filha dos seus pais √© sua...", alternativas: { A: "Prima", B: "Irm√£", C: "Tia", D: "Av√≥" }, correta: "B", explicacao: "A filha dos seus pais √© sua irm√£!" },
                { pergunta: "Quem cuida de voc√™ em casa?", alternativas: { A: "Professor", B: "M√©dico", C: "Fam√≠lia", D: "Carteiro" }, correta: "C", explicacao: "A fam√≠lia cuida de voc√™ em casa!" },
                { pergunta: "O beb√™ da sua tia √© seu...", alternativas: { A: "Irm√£o", B: "Primo", C: "Tio", D: "Sobrinho" }, correta: "B", explicacao: "O beb√™ da tia √© seu primo!" },
                { pergunta: "Quem te leva para a escola?", alternativas: { A: "S√≥ eu", B: "A fam√≠lia", C: "O vizinho", D: "Ningu√©m" }, correta: "B", explicacao: "A fam√≠lia geralmente leva voc√™ para a escola!" },
                { pergunta: "Os pais dos seus pais s√£o seus...", alternativas: { A: "Tios", B: "Primos", C: "Av√≥s", D: "Irm√£os" }, correta: "C", explicacao: "Os pais dos seus pais s√£o seus av√≥s!" }
            ],
            formas: [
                { pergunta: "Quantos lados tem um tri√¢ngulo?", alternativas: { A: "2", B: "3", C: "4", D: "5" }, correta: "B", explicacao: "O tri√¢ngulo tem 3 lados!" },
                { pergunta: "Qual forma tem 4 lados iguais?", alternativas: { A: "Tri√¢ngulo", B: "C√≠rculo", C: "Quadrado", D: "Ret√¢ngulo" }, correta: "C", explicacao: "O quadrado tem 4 lados iguais!" },
                { pergunta: "Qual forma √© redonda?", alternativas: { A: "Quadrado", B: "Tri√¢ngulo", C: "Ret√¢ngulo", D: "C√≠rculo" }, correta: "D", explicacao: "O c√≠rculo √© redondo!" },
                { pergunta: "Uma bola tem forma de...", alternativas: { A: "Cubo", B: "Esfera", C: "Quadrado", D: "Tri√¢ngulo" }, correta: "B", explicacao: "A bola tem forma de esfera!" },
                { pergunta: "Um dado tem forma de...", alternativas: { A: "Esfera", B: "Cubo", C: "C√≠rculo", D: "Tri√¢ngulo" }, correta: "B", explicacao: "O dado tem forma de cubo!" },
                { pergunta: "Quantos lados tem um ret√¢ngulo?", alternativas: { A: "3", B: "4", C: "5", D: "6" }, correta: "B", explicacao: "O ret√¢ngulo tem 4 lados!" },
                { pergunta: "Uma pizza inteira tem forma de...", alternativas: { A: "Quadrado", B: "Tri√¢ngulo", C: "C√≠rculo", D: "Ret√¢ngulo" }, correta: "C", explicacao: "A pizza tem forma de c√≠rculo!" },
                { pergunta: "Uma fatia de pizza tem forma de...", alternativas: { A: "C√≠rculo", B: "Quadrado", C: "Tri√¢ngulo", D: "Ret√¢ngulo" }, correta: "C", explicacao: "A fatia de pizza parece um tri√¢ngulo!" },
                { pergunta: "Uma porta tem forma de...", alternativas: { A: "C√≠rculo", B: "Tri√¢ngulo", C: "Ret√¢ngulo", D: "Esfera" }, correta: "C", explicacao: "A porta tem forma de ret√¢ngulo!" },
                { pergunta: "O que tem mais lados: tri√¢ngulo ou quadrado?", alternativas: { A: "Tri√¢ngulo", B: "Quadrado", C: "S√£o iguais", D: "Nenhum" }, correta: "B", explicacao: "Quadrado tem 4 lados, tri√¢ngulo tem 3!" }
            ],
            corpo: [
                { pergunta: "Quantos olhos voc√™ tem?", alternativas: { A: "1", B: "2", C: "3", D: "4" }, correta: "B", explicacao: "Temos 2 olhos!" },
                { pergunta: "Com o que voc√™ ouve?", alternativas: { A: "Olhos", B: "Nariz", C: "Orelhas", D: "Boca" }, correta: "C", explicacao: "Ouvimos com as orelhas!" },
                { pergunta: "Com o que voc√™ cheira?", alternativas: { A: "Olhos", B: "Nariz", C: "Boca", D: "Orelhas" }, correta: "B", explicacao: "Cheiramos com o nariz!" },
                { pergunta: "Quantos dedos voc√™ tem nos p√©s?", alternativas: { A: "5", B: "10", C: "15", D: "20" }, correta: "B", explicacao: "Temos 10 dedos nos p√©s, 5 em cada!" },
                { pergunta: "O que usamos para mastigar?", alternativas: { A: "L√≠ngua", B: "Nariz", C: "Dentes", D: "Orelha" }, correta: "C", explicacao: "Mastigamos com os dentes!" },
                { pergunta: "O que bombeia sangue no corpo?", alternativas: { A: "Pulm√£o", B: "Est√¥mago", C: "Cora√ß√£o", D: "C√©rebro" }, correta: "C", explicacao: "O cora√ß√£o bombeia sangue!" },
                { pergunta: "Com o que voc√™ pensa?", alternativas: { A: "Cora√ß√£o", B: "C√©rebro", C: "Est√¥mago", D: "Pulm√£o" }, correta: "B", explicacao: "Pensamos com o c√©rebro!" },
                { pergunta: "Quantas pernas voc√™ tem?", alternativas: { A: "1", B: "2", C: "3", D: "4" }, correta: "B", explicacao: "Temos 2 pernas!" },
                { pergunta: "O que fica no meio do rosto?", alternativas: { A: "Olhos", B: "Boca", C: "Nariz", D: "Orelhas" }, correta: "C", explicacao: "O nariz fica no meio do rosto!" },
                { pergunta: "Com o que voc√™ respira?", alternativas: { A: "Est√¥mago", B: "Nariz e boca", C: "Orelhas", D: "Olhos" }, correta: "B", explicacao: "Respiramos pelo nariz e boca!" }
            ],
            frutas: [
                { pergunta: "Qual fruta √© amarela e os macacos adoram?", alternativas: { A: "Ma√ß√£", B: "Banana", C: "Uva", D: "Morango" }, correta: "B", explicacao: "A banana √© amarela e macacos adoram!" },
                { pergunta: "Qual fruta √© vermelha e pequena?", alternativas: { A: "Melancia", B: "Banana", C: "Morango", D: "Laranja" }, correta: "C", explicacao: "O morango √© vermelho e pequeno!" },
                { pergunta: "Qual fruta tem o mesmo nome de sua cor?", alternativas: { A: "Banana", B: "Ma√ß√£", C: "Laranja", D: "Uva" }, correta: "C", explicacao: "A laranja tem o nome da cor laranja!" },
                { pergunta: "Qual fruta √© grande, verde por fora e vermelha por dentro?", alternativas: { A: "Ma√ß√£", B: "Banana", C: "Melancia", D: "Uva" }, correta: "C", explicacao: "A melancia √© verde por fora e vermelha por dentro!" },
                { pergunta: "De que fruta se faz vinho?", alternativas: { A: "Ma√ß√£", B: "Banana", C: "Laranja", D: "Uva" }, correta: "D", explicacao: "O vinho √© feito de uva!" },
                { pergunta: "Qual fruta tem coroa e √© tropical?", alternativas: { A: "Ma√ß√£", B: "Abacaxi", C: "Banana", D: "Morango" }, correta: "B", explicacao: "O abacaxi tem uma coroa de folhas!" },
                { pergunta: "Qual fruta √© usada para fazer suco no caf√© da manh√£?", alternativas: { A: "Uva", B: "Morango", C: "Laranja", D: "Banana" }, correta: "C", explicacao: "Suco de laranja √© comum no caf√© da manh√£!" },
                { pergunta: "Qual fruta tem caro√ßo grande?", alternativas: { A: "Uva", B: "Manga", C: "Morango", D: "Banana" }, correta: "B", explicacao: "A manga tem um caro√ßo grande!" },
                { pergunta: "Qual fruta a Branca de Neve comeu?", alternativas: { A: "Banana", B: "Uva", C: "Ma√ß√£", D: "Laranja" }, correta: "C", explicacao: "Branca de Neve comeu uma ma√ß√£ envenenada!" },
                { pergunta: "Qual fruta √© pequena, roxa e vem em cachos?", alternativas: { A: "Morango", B: "Uva", C: "Cereja", D: "Amora" }, correta: "B", explicacao: "A uva √© pequena, roxa e vem em cachos!" }
            ],
            natureza: [
                { pergunta: "De onde vem a chuva?", alternativas: { A: "Do ch√£o", B: "Das nuvens", C: "Do mar", D: "Das √°rvores" }, correta: "B", explicacao: "A chuva cai das nuvens!" },
                { pergunta: "O que as plantas precisam para crescer?", alternativas: { A: "S√≥ √°gua", B: "√Ågua e sol", C: "S√≥ terra", D: "Nada" }, correta: "B", explicacao: "Plantas precisam de √°gua e sol!" },
                { pergunta: "O que ilumina durante o dia?", alternativas: { A: "Lua", B: "Estrelas", C: "Sol", D: "L√¢mpada" }, correta: "C", explicacao: "O sol ilumina durante o dia!" },
                { pergunta: "O que aparece no c√©u √† noite?", alternativas: { A: "Sol", B: "Arco-√≠ris", C: "Lua e estrelas", D: "Nuvens de chuva" }, correta: "C", explicacao: "√Ä noite vemos a lua e as estrelas!" },
                { pergunta: "Onde os peixes vivem?", alternativas: { A: "Na terra", B: "No ar", C: "Na √°gua", D: "Nas √°rvores" }, correta: "C", explicacao: "Os peixes vivem na √°gua!" },
                { pergunta: "O que as √°rvores produzem para respirarmos?", alternativas: { A: "√Ågua", B: "Comida", C: "Oxig√™nio", D: "Chuva" }, correta: "C", explicacao: "As √°rvores produzem oxig√™nio!" },
                { pergunta: "O arco-√≠ris aparece depois de que?", alternativas: { A: "Neve", B: "Chuva", C: "Vento", D: "Noite" }, correta: "B", explicacao: "O arco-√≠ris aparece depois da chuva!" },
                { pergunta: "Qual esta√ß√£o do ano √© mais quente?", alternativas: { A: "Inverno", B: "Outono", C: "Ver√£o", D: "Primavera" }, correta: "C", explicacao: "O ver√£o √© a esta√ß√£o mais quente!" },
                { pergunta: "De onde vem o mel?", alternativas: { A: "Das √°rvores", B: "Das flores e abelhas", C: "Do rio", D: "Das nuvens" }, correta: "B", explicacao: "As abelhas fazem mel a partir das flores!" },
                { pergunta: "O que cai das √°rvores no outono?", alternativas: { A: "Neve", B: "Chuva", C: "Folhas", D: "Frutas" }, correta: "C", explicacao: "As folhas caem no outono!" }
            ]
        };

        // Perguntas de fallback caso tudo falhe
        const fallbackQuestions = [
            {
                pergunta: "Qual √© a capital do Brasil?",
                alternativas: { A: "Rio de Janeiro", B: "S√£o Paulo", C: "Bras√≠lia", D: "Salvador" },
                correta: "C",
                explicacao: "Bras√≠lia foi inaugurada em 1960 para ser a capital federal."
            },
            {
                pergunta: "Quanto √© 5 + 3?",
                alternativas: { A: "6", B: "7", C: "8", D: "9" },
                correta: "C",
                explicacao: "5 + 3 = 8"
            },
            {
                pergunta: "Qual √© o maior planeta do Sistema Solar?",
                alternativas: { A: "Terra", B: "Marte", C: "J√∫piter", D: "Saturno" },
                correta: "C",
                explicacao: "J√∫piter √© o maior planeta do Sistema Solar!"
            }
        ];

        const SoundButton = ({ soundEnabled, onClick }) => (
            <button 
                onClick={(e) => { e.stopPropagation(); onClick(); }} 
                className="fixed top-4 right-4 z-50 bg-yellow-400 border-4 border-black p-2 rounded shadow-lg hover:scale-110 transition-transform"
                title={soundEnabled ? "Desligar som" : "Ligar som"}
            >
                {soundEnabled ? "üîä" : "üîá"}
            </button>
        );

        // Bot√£o de Acessibilidade
        const AccessibilityButton = ({ enabled, onClick }) => (
            <button 
                onClick={(e) => { e.stopPropagation(); onClick(); }} 
                className={`fixed top-4 right-16 z-50 border-4 border-black p-2 rounded shadow-lg hover:scale-110 transition-transform ${
                    enabled ? 'bg-blue-400' : 'bg-gray-300'
                }`}
                title={enabled ? "Desativar narra√ß√£o" : "Ativar narra√ß√£o para acessibilidade"}
            >
                ‚ôø
            </button>
        );

        // Componente de Modal de Acessibilidade
        const AccessibilityModal = ({ onClose, onActivate }) => (
            <div className="fixed inset-0 flex items-center justify-center z-[100] bg-black bg-opacity-70">
                <div className="bg-white rounded-xl border-4 border-blue-500 p-6 max-w-sm mx-4 shadow-2xl">
                    <div className="text-center mb-4">
                        <span className="text-5xl">‚ôø</span>
                    </div>
                    <h3 className="pixel-font text-lg text-blue-600 text-center mb-3">MODO ACESSIBILIDADE</h3>
                    <p className="text-sm text-gray-700 mb-3 text-center">
                        Narra√ß√£o em voz alta para deficientes visuais
                    </p>
                    
                    <div className="bg-blue-50 border-2 border-blue-300 rounded-lg p-3 mb-3">
                        <p className="text-xs text-blue-700 font-bold mb-1">üìñ Como funciona:</p>
                        <ul className="text-xs text-blue-600 space-y-1">
                            <li>‚Ä¢ <b>Toque em qualquer lugar</b> ‚Üí l√™ o conte√∫do da tela</li>
                            <li>‚Ä¢ <b>Toque em um bot√£o</b> ‚Üí l√™ o nome do bot√£o</li>
                            <li>‚Ä¢ <b>Toque duplo</b> ‚Üí executa a a√ß√£o</li>
                            <li>‚Ä¢ <b>Mudan√ßa de tela</b> ‚Üí narra automaticamente</li>
                        </ul>
                    </div>
                    
                    <div className="bg-green-50 border-2 border-green-300 rounded-lg p-3 mb-3">
                        <p className="text-xs text-green-700 font-bold mb-1">‚úÖ Funciona melhor em:</p>
                        <ul className="text-xs text-green-600">
                            <li>‚Ä¢ Google Chrome</li>
                            <li>‚Ä¢ Microsoft Edge</li>
                            <li>‚Ä¢ Safari</li>
                            <li>‚Ä¢ Firefox</li>
                        </ul>
                    </div>
                    
                    <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3 mb-4">
                        <p className="text-xs text-yellow-700 font-bold mb-1">‚ö†Ô∏è Importante:</p>
                        <p className="text-xs text-yellow-600">
                            Verifique se o volume est√° ligado. Em alguns dispositivos pode n√£o funcionar.
                        </p>
                    </div>
                    
                    <div className="flex gap-2">
                        <button 
                            onClick={onClose}
                            className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg pixel-font text-xs"
                        >
                            CANCELAR
                        </button>
                        <button 
                            onClick={onActivate}
                            className="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg pixel-font text-xs"
                        >
                            ‚úÖ ATIVAR
                        </button>
                    </div>
                </div>
            </div>
        );

        function MarioQuizGame() {
            const [screen, setScreen] = useState('prestart');
            const [gameMode, setGameMode] = useState('1P');
            const [player1Name, setPlayer1Name] = useState('Mario');
            const [player2Name, setPlayer2Name] = useState('Luigi');
            const [subject, setSubject] = useState('');
            const [difficulty, setDifficulty] = useState('medio');
            const [educationLevel, setEducationLevel] = useState('');
            const [course, setCourse] = useState('');
            const [apiKey, setApiKey] = useState('');
            
            // Estados para feedback/melhoria de prompt
            const [feedbackEducation, setFeedbackEducation] = useState('');
            const [feedbackSubject, setFeedbackSubject] = useState('');
            const [feedbackText, setFeedbackText] = useState('');
            const [feedbackSent, setFeedbackSent] = useState(false);
            const [feedbackLoading, setFeedbackLoading] = useState(false);
            const [aiSuggestion, setAiSuggestion] = useState('');
            
            const [currentPlayer, setCurrentPlayer] = useState(1);
            const [player1Score, setPlayer1Score] = useState(0);
            const [player2Score, setPlayer2Score] = useState(0);
            const [player1Lives, setPlayer1Lives] = useState(3);
            const [player2Lives, setPlayer2Lives] = useState(3);
            const [player1Streak, setPlayer1Streak] = useState(0);
            const [player2Streak, setPlayer2Streak] = useState(0);
            const [showBonusLife, setShowBonusLife] = useState(false);
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [characterMood, setCharacterMood] = useState('thinking');
            const [isLoading, setIsLoading] = useState(false);
            
            const [showExplanation, setShowExplanation] = useState(false);
            const [explanationData, setExplanationData] = useState({ correct: false, text: '' });
            const [errorMsg, setErrorMsg] = useState('');
            const [apiStatus, setApiStatus] = useState(''); // 'online' ou 'offline'
            const [ranking, setRanking] = useState([]);
            const [showRanking, setShowRanking] = useState(false);

            // Estados para acessibilidade (narra√ß√£o)
            const [accessibilityEnabled, setAccessibilityEnabled] = useState(false);
            const [showAccessibilityModal, setShowAccessibilityModal] = useState(false);
            const [isReading, setIsReading] = useState(false);
            const [lastTap, setLastTap] = useState(0);
            const [pendingAction, setPendingAction] = useState(null);

            // Fun√ß√£o para ler texto em voz alta
            const speak = (text, callback) => {
                if (!text) return;
                
                // Cancela qualquer leitura anterior
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                // Tenta encontrar voz em portugu√™s
                const voices = window.speechSynthesis.getVoices();
                const ptVoice = voices.find(v => v.lang.includes('pt-BR')) || 
                               voices.find(v => v.lang.includes('pt')) ||
                               voices[0];
                if (ptVoice) {
                    utterance.voice = ptVoice;
                }
                
                utterance.onstart = () => setIsReading(true);
                utterance.onend = () => {
                    setIsReading(false);
                    if (callback) callback();
                };
                utterance.onerror = () => setIsReading(false);
                
                window.speechSynthesis.speak(utterance);
            };

            // Fun√ß√£o para parar a leitura
            const stopSpeaking = () => {
                window.speechSynthesis.cancel();
                setIsReading(false);
            };

            // Fun√ß√£o para narrar a tela atual
            const narrateScreen = () => {
                if (!accessibilityEnabled) return;
                
                let texto = '';
                
                switch(screen) {
                    case 'prestart':
                        texto = 'Tela inicial. Super Quiz Bros. Toque em qualquer lugar para ouvir as op√ß√µes. Toque duplo para selecionar. Bot√£o Iniciar Jogo dispon√≠vel.';
                        break;
                    case 'mode':
                        texto = 'Sele√ß√£o de modo de jogo. Op√ß√£o 1: Um jogador, modo solo. Op√ß√£o 2: Dois jogadores, modo versus. Toque duplo para selecionar.';
                        break;
                    case 'education':
                        texto = 'Sele√ß√£o de n√≠vel de ensino. Op√ß√µes: Educa√ß√£o Infantil, Fundamental 1, Fundamental 2, Ensino M√©dio, Ensino Superior. Toque duplo para selecionar.';
                        break;
                    case 'config':
                        texto = `Configura√ß√£o do jogo. N√≠vel: ${educationLevel}. Escolha um tema e toque duplo em Iniciar Aventura para come√ßar.`;
                        break;
                    case 'question':
                        if (currentQuestion) {
                            texto = `Pergunta n√∫mero ${currentQIndex + 1}. Dificuldade: ${difficulty}. ${currentQuestion.pergunta}. 
                                Alternativa A: ${currentQuestion.alternativas.A}. 
                                Alternativa B: ${currentQuestion.alternativas.B}. 
                                Alternativa C: ${currentQuestion.alternativas.C}. 
                                Alternativa D: ${currentQuestion.alternativas.D}. 
                                Toque duplo na alternativa desejada para responder.`;
                        }
                        break;
                    case 'gameover':
                        texto = `Game Over. Pontua√ß√£o do jogador 1: ${player1Score} pontos. Toque duplo em Menu para voltar ao in√≠cio.`;
                        break;
                    case 'victory':
                        texto = `Parab√©ns! Voc√™ venceu o jogo com 9999 pontos! Toque duplo em Menu para voltar ao in√≠cio.`;
                        break;
                    default:
                        texto = 'Tela do jogo. Toque para ouvir as op√ß√µes.';
                }
                
                speak(texto);
            };

            // Narrar quando a tela muda
            useEffect(() => {
                if (accessibilityEnabled && screen) {
                    // Pequeno delay para garantir que a tela carregou
                    const timer = setTimeout(() => {
                        narrateScreen();
                    }, 500);
                    return () => clearTimeout(timer);
                }
            }, [screen, accessibilityEnabled, currentQuestion]);

            // Narrar resultado quando mostrar explica√ß√£o
            useEffect(() => {
                if (accessibilityEnabled && showExplanation && explanationData) {
                    const texto = explanationData.correct 
                        ? `Correto! Voc√™ acertou! ${explanationData.text}. Toque duplo em Continuar para pr√≥xima pergunta.`
                        : `Errado! ${explanationData.text}. Toque duplo em Continuar para pr√≥xima pergunta.`;
                    speak(texto);
                }
            }, [showExplanation, explanationData, accessibilityEnabled]);

            // Handler para clique com acessibilidade (toque simples = l√™, toque duplo = executa)
            const handleAccessibleClick = (text, action) => {
                if (!accessibilityEnabled) {
                    // Se acessibilidade desativada, executa a√ß√£o normalmente
                    if (action) action();
                    return;
                }
                
                const now = Date.now();
                const timeDiff = now - lastTap;
                
                if (timeDiff < 300 && pendingAction) {
                    // Toque duplo - executa a a√ß√£o
                    stopSpeaking();
                    if (pendingAction) pendingAction();
                    setPendingAction(null);
                } else {
                    // Toque simples - l√™ o texto
                    stopSpeaking();
                    speak(text + '. Toque duplo para selecionar.');
                    setPendingAction(() => action);
                }
                
                setLastTap(now);
            };

            // Toggle acessibilidade
            const toggleAccessibility = () => {
                if (!accessibilityEnabled) {
                    setShowAccessibilityModal(true);
                } else {
                    stopSpeaking();
                    setAccessibilityEnabled(false);
                    speak('Modo acessibilidade desativado.');
                }
            };

            // Ativar acessibilidade ap√≥s modal
            const activateAccessibility = () => {
                setAccessibilityEnabled(true);
                setShowAccessibilityModal(false);
                speak('Modo acessibilidade ativado. Toque em qualquer lugar para ouvir o conte√∫do. Toque duplo para selecionar. Narrando tela atual.');
                setTimeout(() => narrateScreen(), 3000);
            };

            // Carregar vozes quando dispon√≠veis
            useEffect(() => {
                if (typeof window !== 'undefined' && window.speechSynthesis) {
                    window.speechSynthesis.getVoices();
                    window.speechSynthesis.onvoiceschanged = () => {
                        window.speechSynthesis.getVoices();
                    };
                }
            }, []);

            // Carregar ranking do localStorage ao iniciar
            useEffect(() => {
                const savedRanking = localStorage.getItem('quizRanking');
                if (savedRanking) {
                    setRanking(JSON.parse(savedRanking));
                }
            }, []);

            // Salvar no ranking
            const saveToRanking = (playerName, score) => {
                const newEntry = {
                    id: Date.now(),
                    name: playerName,
                    score: score,
                    subject: subject,
                    difficulty: difficulty,
                    educationLevel: educationLevel,
                    course: course || '',
                    date: new Date().toLocaleDateString('pt-BR')
                };

                const updatedRanking = [...ranking, newEntry]
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 10); // Manter apenas top 10

                setRanking(updatedRanking);
                localStorage.setItem('quizRanking', JSON.stringify(updatedRanking));
            };

            // Limpar ranking
            const clearRanking = () => {
                if (confirm('Tem certeza que deseja limpar o ranking?')) {
                    setRanking([]);
                    localStorage.removeItem('quizRanking');
                    playSound('select');
                }
            };

            // Obter label da dificuldade
            const getDifficultyLabel = (diff) => {
                const labels = { 'facil': 'üòä F√°cil', 'medio': 'üòê M√©dio', 'dificil': 'üòà Dif√≠cil' };
                return labels[diff] || diff;
            };

            // Obter label do n√≠vel de ensino
            const getEducationLabel = (edu) => {
                const labels = {
                    'infantil': 'üßí Infantil',
                    'fundamental1': 'üë¶ Fund. I',
                    'fundamental2': 'üßë Fund. II',
                    'medio': 'üë®‚Äçüéì M√©dio',
                    'superior': 'üéì Superior'
                };
                return labels[edu] || edu;
            };
            
            const [soundEnabled, setSoundEnabled] = useState(true);
            const synthRef = useRef(null);
            const currentMusicRef = useRef(null);
            const [currentScreen, setCurrentScreen] = useState('');

            // Defini√ß√£o das m√∫sicas para cada tela
            const musicPatterns = {
                // Tela inicial - estilo Donkey Kong Country (ambiente tropical)
                prestart: {
                    notes: ['C3', 'E3', 'G3', 'C4', 'E4', 'G3', 'C4', 'E4', 'G4', 'E4', 'C4', 'G3', 'E3', 'G3', 'C4', 'G3'],
                    tempo: '4n',
                    volume: -15
                },
                // Sele√ß√£o de modo - melodia animada
                mode: {
                    notes: ['E4', 'G4', 'A4', 'G4', 'E4', 'D4', 'E4', 'G4'],
                    tempo: '8n',
                    volume: -18
                },
                // Sele√ß√£o de educa√ß√£o - melodia suave
                education: {
                    notes: ['C4', 'E4', 'G4', 'E4', 'F4', 'A4', 'G4', 'E4'],
                    tempo: '4n',
                    volume: -18
                },
                // Config superior - melodia acad√™mica
                superior_config: {
                    notes: ['G3', 'B3', 'D4', 'G4', 'F4', 'D4', 'B3', 'G3'],
                    tempo: '4n',
                    volume: -18
                },
                // Configura√ß√£o - melodia preparat√≥ria
                config: {
                    notes: ['D4', 'F4', 'A4', 'F4', 'D4', 'A3', 'D4', 'F4'],
                    tempo: '4n',
                    volume: -18
                },
                // Jogo - melodia de a√ß√£o/tens√£o
                question: {
                    notes: ['A3', 'C4', 'E4', 'A4', 'G4', 'E4', 'C4', 'A3', 'B3', 'D4', 'F4', 'B4', 'A4', 'F4', 'D4', 'B3'],
                    tempo: '8n',
                    volume: -20
                },
                // Game over - melodia triste
                gameover: {
                    notes: ['E3', 'D3', 'C3', 'B2', 'C3', 'D3', 'C3', 'B2'],
                    tempo: '2n',
                    volume: -16
                },
                // Ranking - melodia vitoriosa
                ranking: {
                    notes: ['C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4', 'G4', 'E4', 'C4', 'E4', 'G4'],
                    tempo: '4n',
                    volume: -16
                },
                // Vit√≥ria - melodia √©pica de celebra√ß√£o
                victory: {
                    notes: ['C4', 'E4', 'G4', 'C5', 'E5', 'G5', 'C6', 'G5', 'E5', 'C5', 'G4', 'E4', 'C4', 'E4', 'G4', 'C5'],
                    tempo: '8n',
                    volume: -12
                },
                // Feedback - melodia suave e reflexiva
                feedback: {
                    notes: ['E4', 'G4', 'B4', 'E5', 'D5', 'B4', 'G4', 'E4', 'F4', 'A4', 'C5', 'A4'],
                    tempo: '4n',
                    volume: -18
                }
            };

            const initAudio = async () => {
                if (!synthRef.current) {
                    try {
                        await Tone.start();
                        synthRef.current = new Tone.PolySynth(Tone.Synth, {
                            oscillator: { type: 'square' },
                            envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.3 }
                        }).toDestination();
                        synthRef.current.volume.value = -10;
                    } catch(e) {
                        console.log('Audio n√£o dispon√≠vel');
                    }
                }
            };

            const stopMusic = () => {
                if (currentMusicRef.current) {
                    currentMusicRef.current.stop();
                    currentMusicRef.current.dispose();
                    currentMusicRef.current = null;
                }
                Tone.Transport.stop();
                Tone.Transport.cancel();
            };

            const playMusic = (screenName) => {
                if (!soundEnabled) return;
                
                stopMusic();
                
                const pattern = musicPatterns[screenName];
                if (!pattern) return;

                try {
                    const synth = new Tone.Synth({
                        oscillator: { type: 'triangle' },
                        envelope: { attack: 0.05, decay: 0.2, sustain: 0.3, release: 0.5 }
                    }).toDestination();
                    synth.volume.value = pattern.volume;

                    currentMusicRef.current = new Tone.Sequence((time, note) => {
                        if (note) {
                            synth.triggerAttackRelease(note, pattern.tempo, time);
                        }
                    }, pattern.notes, pattern.tempo);

                    currentMusicRef.current.loop = true;
                    Tone.Transport.bpm.value = screenName === 'question' ? 120 : screenName === 'gameover' ? 60 : 90;
                    Tone.Transport.start();
                    currentMusicRef.current.start(0);
                } catch(e) {
                    console.log('Erro ao tocar m√∫sica:', e);
                }
            };

            // Efeito para trocar m√∫sica quando a tela muda
            useEffect(() => {
                if (soundEnabled && screen !== currentScreen) {
                    setCurrentScreen(screen);
                    playMusic(screen);
                }
                return () => {
                    // Cleanup ao desmontar
                };
            }, [screen, soundEnabled]);

            // Toggle som
            const toggleSound = async () => {
                const newState = !soundEnabled;
                setSoundEnabled(newState);
                if (!newState) {
                    stopMusic();
                } else {
                    await initAudio();
                    playMusic(screen);
                }
            };

            const playSound = (type) => {
                if (!soundEnabled || !synthRef.current) return;
                try {
                    const now = Tone.now();
                    switch(type) {
                        case 'coin': 
                            synthRef.current.triggerAttackRelease("E5", "0.1", now);
                            synthRef.current.triggerAttackRelease("G5", "0.1", now + 0.1);
                            break;
                        case 'wrong': 
                            synthRef.current.triggerAttackRelease("C3", "0.2", now);
                            synthRef.current.triggerAttackRelease("B2", "0.3", now + 0.2);
                            break;
                        case 'start': 
                            synthRef.current.triggerAttackRelease("C4", "0.1", now);
                            synthRef.current.triggerAttackRelease("E4", "0.1", now + 0.1);
                            synthRef.current.triggerAttackRelease("G4", "0.1", now + 0.2);
                            synthRef.current.triggerAttackRelease("C5", "0.2", now + 0.3);
                            break;
                        case 'switch': 
                            synthRef.current.triggerAttackRelease("G4", "0.1", now);
                            synthRef.current.triggerAttackRelease("C5", "0.1", now + 0.1);
                            break;
                        case 'select':
                            synthRef.current.triggerAttackRelease("E4", "0.05", now);
                            break;
                        case 'gameover':
                            synthRef.current.triggerAttackRelease("C4", "0.3", now);
                            synthRef.current.triggerAttackRelease("G3", "0.3", now + 0.3);
                            synthRef.current.triggerAttackRelease("E3", "0.3", now + 0.6);
                            synthRef.current.triggerAttackRelease("C3", "0.5", now + 0.9);
                            break;
                        case 'victory':
                            synthRef.current.triggerAttackRelease("C4", "0.15", now);
                            synthRef.current.triggerAttackRelease("E4", "0.15", now + 0.15);
                            synthRef.current.triggerAttackRelease("G4", "0.15", now + 0.3);
                            synthRef.current.triggerAttackRelease("C5", "0.15", now + 0.45);
                            synthRef.current.triggerAttackRelease("G4", "0.15", now + 0.6);
                            synthRef.current.triggerAttackRelease("C5", "0.3", now + 0.75);
                            break;
                    }
                } catch(e) {}
            };

            // ==========================================
            // FUN√á√ïES DE BUSCA DE PERGUNTAS
            // ==========================================

            // Fun√ß√£o para traduzir texto usando Lingva Translate
            const translateText = async (text) => {
                try {
                    const response = await fetch(`https://lingva.ml/api/v1/en/pt/${encodeURIComponent(text)}`);
                    if (!response.ok) {
                        // Tenta servidor alternativo
                        const response2 = await fetch(`https://lingva.pussthecat.org/api/v1/en/pt/${encodeURIComponent(text)}`);
                        if (!response2.ok) throw new Error('Tradu√ß√£o falhou');
                        const data2 = await response2.json();
                        return data2.translation;
                    }
                    const data = await response.json();
                    return data.translation;
                } catch (error) {
                    console.error('‚ùå Erro na tradu√ß√£o:', error);
                    return text; // Retorna original se falhar
                }
            };

            // Fun√ß√£o para decodificar HTML entities
            const decodeHTML = (html) => {
                const txt = document.createElement('textarea');
                txt.innerHTML = html;
                return txt.value;
            };

            // Fun√ß√£o para buscar pergunta do Open Trivia Database
            const fetchFromTrivia = async () => {
                const categoryId = triviaCategories[subject] || 9; // 9 = General Knowledge
                const difficultyEn = triviadifficulty[difficulty] || 'medium';
                
                try {
                    console.log('üåê Buscando pergunta do Trivia - categoria:', categoryId, 'dificuldade:', difficultyEn);
                    
                    const url = `${TRIVIA_API}?amount=1&category=${categoryId}&difficulty=${difficultyEn}&type=multiple`;
                    const response = await fetch(url);
                    
                    if (!response.ok) throw new Error('Erro ao buscar Trivia');
                    
                    const data = await response.json();
                    
                    if (data.response_code !== 0 || !data.results || data.results.length === 0) {
                        throw new Error('Nenhuma pergunta encontrada no Trivia');
                    }
                    
                    const triviaQ = data.results[0];
                    
                    // Decodifica HTML entities
                    const questionEn = decodeHTML(triviaQ.question);
                    const correctEn = decodeHTML(triviaQ.correct_answer);
                    const incorrectEn = triviaQ.incorrect_answers.map(a => decodeHTML(a));
                    
                    console.log('üìù Pergunta em ingl√™s:', questionEn);
                    
                    // Traduz pergunta
                    const questionPt = await translateText(questionEn);
                    console.log('üáßüá∑ Pergunta traduzida:', questionPt);
                    
                    // Traduz alternativas
                    const correctPt = await translateText(correctEn);
                    const incorrectPt = await Promise.all(incorrectEn.map(a => translateText(a)));
                    
                    // Monta as alternativas embaralhadas
                    const allAnswers = [correctPt, ...incorrectPt];
                    const shuffled = allAnswers.sort(() => Math.random() - 0.5);
                    
                    // Encontra qual letra √© a correta
                    const letters = ['A', 'B', 'C', 'D'];
                    const correctIndex = shuffled.indexOf(correctPt);
                    const correctLetter = letters[correctIndex];
                    
                    return {
                        pergunta: questionPt,
                        alternativas: {
                            A: shuffled[0],
                            B: shuffled[1],
                            C: shuffled[2],
                            D: shuffled[3]
                        },
                        correta: correctLetter,
                        explicacao: `A resposta correta √©: ${correctPt}`
                    };
                    
                } catch (error) {
                    console.error('‚ùå Erro no Trivia:', error);
                    return null;
                }
            };

            // Fun√ß√£o para buscar pergunta infantil (do banco local)
            const getInfantilQuestion = () => {
                const perguntas = perguntasInfantis[subject];
                
                if (!perguntas || perguntas.length === 0) {
                    console.log('‚ö†Ô∏è Tema infantil n√£o encontrado:', subject);
                    // Usa tema "cores" como fallback
                    const fallbackPerguntas = perguntasInfantis['cores'];
                    const disponiveis = fallbackPerguntas.filter(p => !perguntasUsadas.includes(p.pergunta));
                    if (disponiveis.length === 0) {
                        perguntasUsadas = [];
                        return fallbackPerguntas[Math.floor(Math.random() * fallbackPerguntas.length)];
                    }
                    const pergunta = disponiveis[Math.floor(Math.random() * disponiveis.length)];
                    perguntasUsadas.push(pergunta.pergunta);
                    return pergunta;
                }
                
                // Filtra perguntas j√° usadas
                const disponiveis = perguntas.filter(p => !perguntasUsadas.includes(p.pergunta));
                
                if (disponiveis.length === 0) {
                    console.log('‚ö†Ô∏è Todas as perguntas infantis foram usadas, resetando...');
                    perguntasUsadas = [];
                    return perguntas[Math.floor(Math.random() * perguntas.length)];
                }
                
                const pergunta = disponiveis[Math.floor(Math.random() * disponiveis.length)];
                perguntasUsadas.push(pergunta.pergunta);
                
                console.log('üë∂ Pergunta infantil:', pergunta.pergunta);
                return pergunta;
            };

            // Fun√ß√£o principal para buscar pergunta
            const getQuestion = async () => {
                // Se for n√≠vel infantil, usa perguntas locais
                if (educationLevel === 'infantil') {
                    return getInfantilQuestion();
                }
                
                // Para outros n√≠veis, usa Trivia + Tradu√ß√£o
                const triviaQuestion = await fetchFromTrivia();
                
                if (triviaQuestion) {
                    return triviaQuestion;
                }
                
                // Fallback se Trivia falhar
                console.log('‚ö†Ô∏è Usando pergunta fallback');
                return fallbackQuestions[Math.floor(Math.random() * fallbackQuestions.length)];
            };

            // Fun√ß√£o para enviar feedback (simplificada)
            const sendFeedback = async () => {
                if (!feedbackText.trim()) {
                    setErrorMsg('Por favor, descreva sua sugest√£o!');
                    return;
                }

                setFeedbackLoading(true);
                setErrorMsg('');

                // Simula envio
                setTimeout(() => {
                    setAiSuggestion('Obrigado pelo seu feedback! Sua sugest√£o foi registrada e ser√° analisada para melhorar o jogo. üéÆ');
                    setFeedbackSent(true);
                    setFeedbackLoading(false);
                    playSound('coin');
                }, 1000);
            };

            const resetFeedback = () => {
                setFeedbackEducation('');
                setFeedbackSubject('');
                setFeedbackText('');
                setFeedbackSent(false);
                setAiSuggestion('');
                setErrorMsg('');
            };

            const loadQuestion = async () => {
                setIsLoading(true);
                setCharacterMood('thinking');
                setErrorMsg('');
                
                try {
                    console.log('üîç Buscando pergunta...');
                    const question = await getQuestion();
                    
                    if (question) {
                        setCurrentQuestion(question);
                        setApiStatus('online');
                        console.log('‚úÖ Pergunta carregada:', question.pergunta);
                    } else {
                        throw new Error('Nenhuma pergunta dispon√≠vel');
                    }
                    
                } catch (error) {
                    console.error("‚ùå Erro:", error);
                    const fallback = fallbackQuestions[Math.floor(Math.random() * fallbackQuestions.length)];
                    setCurrentQuestion(fallback);
                    setApiStatus('offline');
                    setErrorMsg(`Usando perguntas locais`);
                }
                
                setIsLoading(false);
            };

            const startGame = async () => {
                // Para infantil, precisa escolher tema. Para outros, usa categoria geral se n√£o escolheu
                if (educationLevel === 'infantil' && !subject) {
                    setErrorMsg('Por favor, escolha um tema!');
                    return;
                }
                
                // Se n√£o escolheu tema, usa 'geral'
                if (!subject) {
                    setSubject('geral');
                }
                
                initAudio();
                playSound('start');
                
                // Reset total
                setPlayer1Score(0);
                setPlayer2Score(0);
                setPlayer1Lives(3);
                setPlayer2Lives(3);
                setPlayer1Streak(0);
                setPlayer2Streak(0);
                setShowBonusLife(false);
                setCurrentPlayer(1);
                setCurrentQIndex(0);
                
                // Come√ßa sempre no f√°cil (dificuldade progressiva)
                setDifficulty('facil');
                
                setScreen('question');
                await loadQuestion();
            };

            const handleAnswer = (key) => {
                if (!currentQuestion) return;
                
                const isCorrect = key === currentQuestion.correta;
                
                if (isCorrect) {
                    playSound('coin');
                    let newScore = 0;
                    let gotBonusLife = false;
                    
                    if (currentPlayer === 1) {
                        newScore = player1Score + 100;
                        setPlayer1Score(newScore);
                        const newStreak = player1Streak + 1;
                        setPlayer1Streak(newStreak);
                        // A cada 3 acertos consecutivos, ganha vida extra
                        if (newStreak > 0 && newStreak % 3 === 0) {
                            setPlayer1Lives(l => l + 1);
                            gotBonusLife = true;
                        }
                        // Verifica se atingiu pontua√ß√£o m√°xima
                        if (newScore >= 9999) {
                            setPlayer1Score(9999);
                            saveToRanking(player1Name, 9999);
                            setScreen('victory');
                            return;
                        }
                    } else {
                        newScore = player2Score + 100;
                        setPlayer2Score(newScore);
                        const newStreak = player2Streak + 1;
                        setPlayer2Streak(newStreak);
                        if (newStreak > 0 && newStreak % 3 === 0) {
                            setPlayer2Lives(l => l + 1);
                            gotBonusLife = true;
                        }
                        // Verifica se atingiu pontua√ß√£o m√°xima
                        if (newScore >= 9999) {
                            setPlayer2Score(9999);
                            saveToRanking(player2Name, 9999);
                            setScreen('victory');
                            return;
                        }
                    }
                    
                    // Mostra mensagem de vida extra
                    if (gotBonusLife) {
                        setShowBonusLife(true);
                        setTimeout(() => setShowBonusLife(false), 3000);
                    }
                    
                    // DIFICULDADE PROGRESSIVA: aumenta a cada 5 perguntas corretas
                    const totalCorretas = currentQIndex + 1;
                    if (totalCorretas >= 10 && difficulty !== 'dificil') {
                        setDifficulty('dificil');
                        console.log('üî• Dificuldade aumentou para DIF√çCIL!');
                    } else if (totalCorretas >= 5 && difficulty === 'facil') {
                        setDifficulty('medio');
                        console.log('‚ö° Dificuldade aumentou para M√âDIO!');
                    }
                    
                    setCharacterMood('happy');
                    setExplanationData({ correct: true, text: currentQuestion.explicacao });
                } else {
                    playSound('wrong');
                    if (currentPlayer === 1) {
                        setPlayer1Lives(l => l - 1);
                        setPlayer1Streak(0); // Reset streak ao errar
                    } else {
                        setPlayer2Lives(l => l - 1);
                        setPlayer2Streak(0);
                    }
                    
                    setCharacterMood('sad');
                    const textoErro = `A resposta correta era ${currentQuestion.correta}. ${currentQuestion.explicacao}`;
                    setExplanationData({ 
                        correct: false, 
                        text: textoErro 
                    });
                }
                setShowExplanation(true);
            };

            const nextStep = async () => {
                setShowExplanation(false);
                
                // Checar Game Over
                const p1Dead = player1Lives <= 0;
                const p2Dead = gameMode === '2P' && player2Lives <= 0;
                
                if (gameMode === '1P' && p1Dead) {
                    setScreen('gameover');
                    return;
                }
                
                if (gameMode === '2P') {
                    if (p1Dead && p2Dead) {
                        setScreen('gameover');
                        return;
                    }
                    // Troca de turno se ambos vivos, ou mantem quem est√° vivo
                    if (!p1Dead && !p2Dead) {
                        setCurrentPlayer(prev => prev === 1 ? 2 : 1);
                        playSound('switch');
                    } else if (p1Dead) {
                        setCurrentPlayer(2);
                    } else if (p2Dead) {
                        setCurrentPlayer(1);
                    }
                }
                
                setCurrentQIndex(i => i + 1);
                await loadQuestion();
            };

            // Renderiza√ß√£o das Telas
            if (screen === 'prestart') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-blue-900 via-blue-700 to-blue-500 text-white fade-in p-4 relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        <AccessibilityButton enabled={accessibilityEnabled} onClick={toggleAccessibility} />
                        
                        {/* Modal de Acessibilidade */}
                        {showAccessibilityModal && (
                            <AccessibilityModal 
                                onClose={() => setShowAccessibilityModal(false)}
                                onActivate={activateAccessibility}
                            />
                        )}

                        {/* Indicador de acessibilidade ativa */}
                        {accessibilityEnabled && (
                            <div className="fixed bottom-4 left-4 z-40 bg-blue-500 text-white px-3 py-1 rounded-full text-xs pixel-font flex items-center gap-1">
                                ‚ôø {isReading ? 'üîä Lendo...' : 'Ativo'}
                            </div>
                        )}

                        {/* Estrelas de fundo animadas */}
                        <div className="absolute inset-0 overflow-hidden">
                            {[...Array(30)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-yellow-300"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 60}%`,
                                        animation: `twinkle ${1 + Math.random() * 2}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`,
                                        fontSize: `${Math.random() * 6 + 2}px`
                                    }}
                                >‚òÖ</div>
                            ))}
                        </div>

                        {/* Nuvens estilo 16-bit */}
                        <div className="absolute top-8 left-[5%] opacity-90" style={{animation: 'floatCloud 8s ease-in-out infinite'}}>
                            <div className="flex">
                                <div className="w-8 h-8 bg-white rounded-full"></div>
                                <div className="w-12 h-12 bg-white rounded-full -ml-4 -mt-2"></div>
                                <div className="w-10 h-10 bg-white rounded-full -ml-4 mt-1"></div>
                            </div>
                        </div>
                        <div className="absolute top-20 right-[10%] opacity-70" style={{animation: 'floatCloud 10s ease-in-out infinite reverse'}}>
                            <div className="flex">
                                <div className="w-6 h-6 bg-white rounded-full"></div>
                                <div className="w-10 h-10 bg-white rounded-full -ml-3 -mt-2"></div>
                                <div className="w-8 h-8 bg-white rounded-full -ml-3 mt-1"></div>
                            </div>
                        </div>
                        <div className="absolute top-32 left-[20%] opacity-60" style={{animation: 'floatCloud 12s ease-in-out infinite'}}>
                            <div className="flex">
                                <div className="w-5 h-5 bg-white rounded-full"></div>
                                <div className="w-8 h-8 bg-white rounded-full -ml-2 -mt-1"></div>
                                <div className="w-6 h-6 bg-white rounded-full -ml-2 mt-1"></div>
                            </div>
                        </div>

                        {/* T√≠tulo principal estilo 16-bit */}
                        <div className="relative z-10 mb-2 md:mb-4">
                            <h1 
                                className="text-2xl md:text-5xl text-yellow-400 pixel-font text-center leading-relaxed"
                                style={{
                                    textShadow: '2px 2px 0px #b45309, 4px 4px 0px #78350f, -1px -1px 0px #fef08a',
                                    animation: 'titlePulse 2s ease-in-out infinite'
                                }}
                            >
                                SUPER
                            </h1>
                            <h1 
                                className="text-2xl md:text-5xl text-yellow-400 pixel-font text-center leading-relaxed"
                                style={{
                                    textShadow: '2px 2px 0px #b45309, 4px 4px 0px #78350f, -1px -1px 0px #fef08a',
                                    animation: 'titlePulse 2s ease-in-out infinite',
                                    animationDelay: '0.1s'
                                }}
                            >
                                QUIZ BROS
                            </h1>
                        </div>

                        {/* Subt√≠tulo animado - Blocos com texto */}
                        <div className="flex gap-1 mb-4 md:mb-8 relative z-10">
                            {['V','I','V','E','N','D','O'].map((letter, i) => (
                                <div 
                                    key={i}
                                    className="w-6 h-6 md:w-10 md:h-10 bg-yellow-500 border-2 md:border-4 border-yellow-700 rounded flex items-center justify-center pixel-font text-xs md:text-sm text-yellow-900 font-bold"
                                    style={{
                                        animation: 'blockBounce 0.5s ease-in-out infinite',
                                        animationDelay: `${i * 0.1}s`,
                                        boxShadow: 'inset -2px -2px 0px #b45309, inset 2px 2px 0px #fef08a'
                                    }}
                                >{letter}</div>
                            ))}
                        </div>
                        <div className="flex gap-1 mb-2 relative z-10">
                            {['V','A','L','O','R','E','S'].map((letter, i) => (
                                <div 
                                    key={i}
                                    className="w-6 h-6 md:w-10 md:h-10 bg-yellow-500 border-2 md:border-4 border-yellow-700 rounded flex items-center justify-center pixel-font text-xs md:text-sm text-yellow-900 font-bold"
                                    style={{
                                        animation: 'blockBounce 0.5s ease-in-out infinite',
                                        animationDelay: `${(i + 7) * 0.1}s`,
                                        boxShadow: 'inset -2px -2px 0px #b45309, inset 2px 2px 0px #fef08a'
                                    }}
                                >{letter}</div>
                            ))}
                        </div>

                        {/* Segunda linha do slogan */}
                        <div className="text-center mb-4 md:mb-8 relative z-10">
                            <p 
                                className="pixel-font text-xs md:text-sm text-white mt-2 md:mt-4"
                                style={{
                                    textShadow: '2px 2px 0px #1e3a5f',
                                    animation: 'fadeInOut 3s ease-in-out infinite'
                                }}
                            >
                                APRENDENDO PARA A VIDA
                            </p>
                        </div>

                        {/* Bot√£o Start estilo 16-bit */}
                        <button 
                            onClick={() => handleAccessibleClick('Bot√£o Iniciar Jogo. Pressione novamente para come√ßar.', async () => {
                                await initAudio();
                                playSound('start');
                                setScreen('mode');
                            })} 
                            className="relative z-10 bg-gradient-to-b from-red-500 to-red-700 text-white font-bold py-3 px-6 md:py-4 md:px-8 rounded-lg border-4 border-red-300 pixel-font text-sm md:text-lg shadow-lg hover:from-red-400 hover:to-red-600 transition-all mb-3 md:mb-4 active:scale-95"
                            style={{
                                boxShadow: '0 6px 0px #7f1d1d, 0 8px 10px rgba(0,0,0,0.3)',
                                animation: 'buttonPulse 1.5s ease-in-out infinite'
                            }}
                        >
                            PRESS START
                        </button>

                        {/* Bot√£o Ranking */}
                        <button 
                            onClick={() => handleAccessibleClick('Bot√£o Ranking. Ver pontua√ß√µes dos jogadores.', async () => {
                                await initAudio();
                                playSound('select');
                                setScreen('ranking');
                            })} 
                            className="relative z-10 bg-gradient-to-b from-yellow-500 to-yellow-700 text-white font-bold py-2 px-4 md:py-3 md:px-6 rounded-lg border-4 border-yellow-300 pixel-font text-xs md:text-sm shadow-lg hover:from-yellow-400 hover:to-yellow-600 transition-all mb-3 active:scale-95"
                            style={{
                                boxShadow: '0 4px 0px #92400e, 0 6px 8px rgba(0,0,0,0.3)'
                            }}
                        >
                            üèÜ RANKING
                        </button>

                        {/* Bot√£o Feedback/Melhorar */}
                        <button 
                            onClick={() => handleAccessibleClick('Bot√£o Ajude a Melhorar. Enviar sugest√µes.', async () => {
                                await initAudio();
                                playSound('select');
                                resetFeedback();
                                setScreen('feedback');
                            })} 
                            className="relative z-10 bg-gradient-to-b from-purple-500 to-purple-700 text-white font-bold py-2 px-4 md:py-3 md:px-6 rounded-lg border-4 border-purple-300 pixel-font text-xs md:text-sm shadow-lg hover:from-purple-400 hover:to-purple-600 transition-all mb-12 md:mb-16 active:scale-95"
                            style={{
                                boxShadow: '0 4px 0px #581c87, 0 6px 8px rgba(0,0,0,0.3)'
                            }}
                        >
                            üí° AJUDE A MELHORAR
                        </button>

                        {/* Cr√©dito */}
                        <div className="relative z-20 text-center mb-2 md:mb-4">
                            <p className="text-xs pixel-font text-blue-200 opacity-70">¬© 2025 QUIZ EDUCATIVO</p>
                            <p className="text-xs pixel-font text-blue-200 opacity-60 mt-1" style={{fontSize: '8px'}}>por M. Dancini, Claude IA, GPT e GEMINI</p>
                        </div>

                        {/* Colinas no fundo */}
                        <div className="absolute bottom-8 left-0 right-0 z-0">
                            <svg viewBox="0 0 400 60" className="w-full h-10 opacity-40">
                                <ellipse cx="50" cy="60" rx="80" ry="40" fill="#166534"/>
                                <ellipse cx="150" cy="60" rx="60" ry="30" fill="#15803d"/>
                                <ellipse cx="280" cy="60" rx="90" ry="45" fill="#166534"/>
                                <ellipse cx="380" cy="60" rx="70" ry="35" fill="#15803d"/>
                            </svg>
                        </div>

                        {/* Ch√£o estilo Mario World com blocos */}
                        <div className="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-b from-green-500 to-green-700 border-t-4 border-green-400 z-10">
                            <div className="flex justify-center gap-0 h-full">
                                {[...Array(30)].map((_, i) => (
                                    <div 
                                        key={i} 
                                        className="w-6 h-full border-r border-green-600"
                                        style={{
                                            background: i % 2 === 0 
                                                ? 'linear-gradient(to bottom, #22c55e 0%, #16a34a 50%, #15803d 100%)' 
                                                : 'linear-gradient(to bottom, #16a34a 0%, #15803d 50%, #166534 100%)'
                                        }}
                                    ></div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'mode') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-indigo-900 via-purple-800 to-purple-600 p-4 flex flex-col items-center justify-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Elementos decorativos */}
                        <div className="absolute top-10 left-10 text-5xl opacity-60" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>‚≠ê</div>
                        <div className="absolute top-20 right-16 text-4xl opacity-40" style={{animation: 'floatCloud 3s ease-in-out infinite reverse'}}>‚≠ê</div>
                        <div className="absolute bottom-32 left-16 text-3xl opacity-50" style={{animation: 'floatCloud 5s ease-in-out infinite'}}>üåô</div>

                        <h2 className="text-2xl md:text-3xl text-white pixel-font mb-4 text-center drop-shadow-lg">SELECIONE O</h2>
                        <h2 className="text-3xl md:text-4xl text-yellow-400 pixel-font mb-12 text-center drop-shadow-lg">MODO DE JOGO</h2>
                        
                        <div className="flex flex-col md:flex-row gap-6 mb-8">
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setGameMode('1P'); 
                                    setScreen('education'); 
                                }} 
                                className="bg-red-500 hover:bg-red-600 text-white p-8 rounded-xl border-4 border-red-300 pixel-font text-lg hover:scale-110 transition-all shadow-2xl flex flex-col items-center gap-4"
                            >
                                <span className="text-6xl">üë§</span>
                                <span>1 JOGADOR</span>
                                <span className="text-xs text-red-200">MODO SOLO</span>
                            </button>
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setGameMode('2P'); 
                                    setScreen('education'); 
                                }} 
                                className="bg-green-500 hover:bg-green-600 text-white p-8 rounded-xl border-4 border-green-300 pixel-font text-lg hover:scale-110 transition-all shadow-2xl flex flex-col items-center gap-4"
                            >
                                <span className="text-6xl">üë•</span>
                                <span>2 JOGADORES</span>
                                <span className="text-xs text-green-200">MODO VERSUS</span>
                            </button>
                        </div>

                        <button 
                            onClick={() => { playSound('select'); setScreen('prestart'); }}
                            className="text-white pixel-font text-sm hover:text-yellow-400 transition-colors"
                        >
                            ‚Üê VOLTAR
                        </button>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-purple-900 border-t-4 border-purple-950"></div>
                    </div>
                );
            }

            // TELA DE SELE√á√ÉO DE N√çVEL DE ENSINO
            if (screen === 'education') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-cyan-600 via-blue-600 to-indigo-700 p-4 flex flex-col items-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Elementos decorativos */}
                        <div className="absolute top-10 left-5 text-4xl opacity-60" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>üìö</div>
                        <div className="absolute top-20 right-10 text-5xl opacity-40" style={{animation: 'floatCloud 3s ease-in-out infinite reverse'}}>üéì</div>
                        <div className="absolute bottom-32 right-16 text-3xl opacity-50" style={{animation: 'floatCloud 5s ease-in-out infinite'}}>‚úèÔ∏è</div>

                        <h2 className="text-xl md:text-2xl text-white pixel-font mb-2 text-center drop-shadow-lg mt-4">SELECIONE O</h2>
                        <h2 className="text-2xl md:text-3xl text-yellow-400 pixel-font mb-6 text-center drop-shadow-lg">N√çVEL DE ENSINO</h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl w-full px-4 relative z-10">
                            {/* Educa√ß√£o Infantil */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('infantil');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-pink-500 hover:bg-pink-600 text-white p-4 rounded-xl border-4 border-pink-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üßí</span>
                                <div className="text-left">
                                    <div>EDUCA√á√ÉO INFANTIL</div>
                                    <div className="text-xs text-pink-200">4 a 5 anos</div>
                                </div>
                            </button>

                            {/* Fundamental 1 */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('fundamental1');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-orange-500 hover:bg-orange-600 text-white p-4 rounded-xl border-4 border-orange-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üë¶</span>
                                <div className="text-left">
                                    <div>FUNDAMENTAL I</div>
                                    <div className="text-xs text-orange-200">1¬∫ ao 5¬∫ ano</div>
                                </div>
                            </button>

                            {/* Fundamental 2 */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('fundamental2');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-green-500 hover:bg-green-600 text-white p-4 rounded-xl border-4 border-green-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üßë</span>
                                <div className="text-left">
                                    <div>FUNDAMENTAL II</div>
                                    <div className="text-xs text-green-200">6¬∫ ao 9¬∫ ano</div>
                                </div>
                            </button>

                            {/* Ensino M√©dio */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('medio');
                                    setCourse('');
                                    setScreen('config'); 
                                }} 
                                className="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-xl border-4 border-blue-300 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3"
                            >
                                <span className="text-4xl">üë®‚Äçüéì</span>
                                <div className="text-left">
                                    <div>ENSINO M√âDIO</div>
                                    <div className="text-xs text-blue-200">1¬∫ ao 3¬∫ ano</div>
                                </div>
                            </button>

                            {/* Ensino Superior */}
                            <button 
                                onClick={() => { 
                                    playSound('select');
                                    setEducationLevel('superior');
                                    setScreen('superior_config'); 
                                }} 
                                className="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-xl border-4 border-purple-400 pixel-font text-sm hover:scale-105 transition-all shadow-xl flex items-center gap-3 md:col-span-2"
                            >
                                <span className="text-4xl">üéì</span>
                                <div className="text-left">
                                    <div>ENSINO SUPERIOR</div>
                                    <div className="text-xs text-purple-200">Gradua√ß√£o / P√≥s-gradua√ß√£o</div>
                                </div>
                            </button>
                        </div>

                        <button 
                            onClick={() => { playSound('select'); setScreen('mode'); }}
                            className="text-white pixel-font text-sm hover:text-yellow-400 transition-colors mt-6 relative z-10"
                        >
                            ‚Üê VOLTAR
                        </button>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-indigo-900 border-t-4 border-indigo-950"></div>
                    </div>
                );
            }

            // TELA DE CONFIGURA√á√ÉO DO ENSINO SUPERIOR
            if (screen === 'superior_config') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-purple-900 via-purple-700 to-indigo-800 p-4 flex flex-col items-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Elementos decorativos */}
                        <div className="absolute top-10 left-10 text-5xl opacity-40" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>üéì</div>
                        <div className="absolute top-20 right-16 text-4xl opacity-30" style={{animation: 'floatCloud 3s ease-in-out infinite reverse'}}>üìñ</div>

                        <div className="bg-white p-4 md:p-6 rounded-xl border-4 border-purple-400 shadow-2xl max-w-md w-full relative z-10 mt-4">
                            <div className="flex justify-center mb-3">
                                <span className="text-4xl">üéì</span>
                            </div>
                            <h2 className="text-lg mb-4 pixel-font text-center text-purple-800">ENSINO SUPERIOR</h2>
                            
                            <div className="mb-4">
                                <label className="block pixel-font text-xs mb-2 text-purple-600">üìö ESCOLHA A √ÅREA:</label>
                                <div className="grid grid-cols-2 gap-2">
                                    {[
                                        { id: 'direito', label: '‚öñÔ∏è Direito' },
                                        { id: 'medicina', label: 'üè• Medicina' },
                                        { id: 'engenharia', label: 'üîß Engenharia' },
                                        { id: 'administracao', label: 'üìä Administra√ß√£o' },
                                        { id: 'psicologia', label: 'üß† Psicologia' },
                                        { id: 'educacao', label: 'üìö Educa√ß√£o' },
                                        { id: 'computacao', label: 'üíª Computa√ß√£o' },
                                        { id: 'economia', label: 'üìà Economia' },
                                        { id: 'biologia', label: 'üß¨ Biologia' },
                                        { id: 'historia', label: 'üìú Hist√≥ria' },
                                        { id: 'matematica', label: '‚ûï Matem√°tica' },
                                        { id: 'geral', label: 'üìñ Geral' }
                                    ].map(tema => (
                                        <button 
                                            key={tema.id}
                                            type="button"
                                            onClick={() => { 
                                                playSound('select'); 
                                                setCourse(tema.label.split(' ')[1]);
                                                setSubject(tema.id); 
                                            }}
                                            className={`p-2 rounded-lg border-4 pixel-font text-xs transition-all ${
                                                subject === tema.id 
                                                    ? 'bg-purple-500 text-white border-purple-700 scale-105' 
                                                    : 'bg-white border-gray-300 hover:bg-purple-50 hover:border-purple-300'
                                            }`}
                                        >
                                            {tema.label}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {errorMsg && <div className="text-red-500 text-xs mb-4 pixel-font text-center bg-red-100 p-2 rounded">{errorMsg}</div>}

                            <button 
                                onClick={() => {
                                    if (!subject) {
                                        setErrorMsg('Por favor, escolha uma √°rea!');
                                        return;
                                    }
                                    setErrorMsg('');
                                    playSound('select');
                                    setScreen('config');
                                }} 
                                className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg border-4 border-purple-800 pixel-font hover:scale-105 transition-transform shadow-lg"
                            >
                                CONTINUAR ‚Üí
                            </button>

                            <button 
                                onClick={() => { playSound('select'); setScreen('education'); }}
                                className="w-full mt-3 text-gray-500 pixel-font text-xs hover:text-gray-800 transition-colors"
                            >
                                ‚Üê VOLTAR
                            </button>
                        </div>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-purple-950 border-t-4 border-black"></div>
                    </div>
                );
            }

            if (screen === 'config') {
                const educationLabels = {
                    'infantil': { icon: 'üßí', name: 'Educa√ß√£o Infantil', color: 'pink' },
                    'fundamental1': { icon: 'üë¶', name: 'Fundamental I', color: 'orange' },
                    'fundamental2': { icon: 'üßë', name: 'Fundamental II', color: 'green' },
                    'medio': { icon: 'üë®‚Äçüéì', name: 'Ensino M√©dio', color: 'blue' },
                    'superior': { icon: 'üéì', name: `Superior - ${course}`, color: 'purple' }
                };
                const currentEdu = educationLabels[educationLevel] || { icon: 'üìö', name: 'Geral', color: 'gray' };

                return (
                    <div className="min-h-screen bg-gradient-to-b from-sky-400 via-sky-300 to-green-400 p-4 flex flex-col items-center fade-in justify-center relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        {/* Nuvens */}
                        <div className="absolute top-5 left-5 text-5xl opacity-70" style={{animation: 'floatCloud 4s ease-in-out infinite'}}>‚òÅÔ∏è</div>
                        <div className="absolute top-16 right-10 text-7xl opacity-50" style={{animation: 'floatCloud 5s ease-in-out infinite reverse'}}>‚òÅÔ∏è</div>
                        
                        {/* Canos decorativos */}
                        <div className="absolute bottom-0 left-10 w-16 h-24 bg-green-600 border-4 border-green-800 rounded-t-lg"></div>
                        <div className="absolute bottom-0 right-10 w-16 h-32 bg-green-600 border-4 border-green-800 rounded-t-lg"></div>

                        <div className="bg-white p-6 md:p-8 rounded-xl border-4 border-black shadow-2xl max-w-md w-full relative z-10">
                            {/* Indicador do n√≠vel de ensino */}
                            <div className={`bg-${currentEdu.color}-100 border-2 border-${currentEdu.color}-400 rounded-lg p-2 mb-4 flex items-center justify-center gap-2`} style={{backgroundColor: currentEdu.color === 'pink' ? '#fce7f3' : currentEdu.color === 'orange' ? '#ffedd5' : currentEdu.color === 'green' ? '#dcfce7' : currentEdu.color === 'blue' ? '#dbeafe' : '#f3e8ff'}}>
                                <span className="text-2xl">{currentEdu.icon}</span>
                                <span className="pixel-font text-xs text-gray-700">{currentEdu.name}</span>
                            </div>

                            <div className="flex justify-center mb-4">
                                <span className="text-4xl">{gameMode === '1P' ? 'üë§' : 'üë•'}</span>
                            </div>
                            <h2 className="text-xl md:text-2xl mb-6 pixel-font text-center text-gray-800">CONFIGURA√á√ÉO</h2>
                            
                            <div className="mb-4">
                                <label className="block pixel-font text-xs mb-2 text-red-600">üî¥ JOGADOR 1:</label>
                                <input 
                                    type="text" 
                                    value={player1Name} 
                                    onChange={(e) => setPlayer1Name(e.target.value)} 
                                    className="w-full p-3 border-4 border-gray-300 rounded-lg pixel-font focus:border-red-500 outline-none transition-colors"
                                />
                            </div>

                            {gameMode === '2P' && (
                                <div className="mb-4">
                                    <label className="block pixel-font text-xs mb-2 text-green-600">üü¢ JOGADOR 2:</label>
                                    <input 
                                        type="text" 
                                        value={player2Name} 
                                        onChange={(e) => setPlayer2Name(e.target.value)} 
                                        className="w-full p-3 border-4 border-gray-300 rounded-lg pixel-font focus:border-green-500 outline-none transition-colors"
                                    />
                                </div>
                            )}

                            {/* Sele√ß√£o de tema por bot√µes - espec√≠fico para cada n√≠vel */}
                            {educationLevel !== 'superior' && (
                                <div className="mb-4">
                                    <label className="block pixel-font text-xs mb-2 text-blue-600">üìö ESCOLHA O TEMA:</label>
                                    
                                    {/* Temas para INFANTIL */}
                                    {educationLevel === 'infantil' && (
                                        <div className="grid grid-cols-2 gap-2">
                                            {[
                                                { id: 'cores', label: 'üé® Cores', color: 'pink' },
                                                { id: 'animais', label: 'üêæ Animais', color: 'orange' },
                                                { id: 'numeros', label: 'üî¢ N√∫meros', color: 'blue' },
                                                { id: 'familia', label: 'üë®‚Äçüë©‚Äçüëß Fam√≠lia', color: 'purple' },
                                                { id: 'formas', label: '‚¨õ Formas', color: 'green' },
                                                { id: 'corpo', label: 'üñêÔ∏è Corpo', color: 'red' },
                                                { id: 'frutas', label: 'üçé Frutas', color: 'yellow' },
                                                { id: 'natureza', label: 'üå≥ Natureza', color: 'teal' }
                                            ].map(tema => (
                                                <button 
                                                    key={tema.id}
                                                    type="button"
                                                    onClick={() => { playSound('select'); setSubject(tema.id); }}
                                                    className={`p-3 rounded-lg border-4 pixel-font text-xs transition-all ${
                                                        subject === tema.id 
                                                            ? 'bg-blue-500 text-white border-blue-700 scale-105' 
                                                            : 'bg-white border-gray-300 hover:bg-blue-50 hover:border-blue-300'
                                                    }`}
                                                >
                                                    {tema.label}
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {/* Temas para FUNDAMENTAL 1 */}
                                    {educationLevel === 'fundamental1' && (
                                        <div className="grid grid-cols-2 gap-2">
                                            {[
                                                { id: 'matematica', label: '‚ûï Matem√°tica', color: 'blue' },
                                                { id: 'portugues', label: 'üìñ Portugu√™s', color: 'red' },
                                                { id: 'ciencias', label: 'üî¨ Ci√™ncias', color: 'green' },
                                                { id: 'historia', label: 'üìú Hist√≥ria', color: 'orange' },
                                                { id: 'geografia', label: 'üåç Geografia', color: 'teal' },
                                                { id: 'geral', label: 'üìö Geral', color: 'purple' }
                                            ].map(tema => (
                                                <button 
                                                    key={tema.id}
                                                    type="button"
                                                    onClick={() => { playSound('select'); setSubject(tema.id); }}
                                                    className={`p-3 rounded-lg border-4 pixel-font text-xs transition-all ${
                                                        subject === tema.id 
                                                            ? 'bg-blue-500 text-white border-blue-700 scale-105' 
                                                            : 'bg-white border-gray-300 hover:bg-blue-50 hover:border-blue-300'
                                                    }`}
                                                >
                                                    {tema.label}
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {/* Temas para FUNDAMENTAL 2 */}
                                    {educationLevel === 'fundamental2' && (
                                        <div className="grid grid-cols-2 gap-2">
                                            {[
                                                { id: 'matematica', label: '‚ûï Matem√°tica', color: 'blue' },
                                                { id: 'portugues', label: 'üìñ Portugu√™s', color: 'red' },
                                                { id: 'ciencias', label: 'üî¨ Ci√™ncias', color: 'green' },
                                                { id: 'historia', label: 'üìú Hist√≥ria', color: 'orange' },
                                                { id: 'geografia', label: 'üåç Geografia', color: 'teal' },
                                                { id: 'ingles', label: 'üá∫üá∏ Ingl√™s', color: 'indigo' },
                                                { id: 'artes', label: 'üé® Artes', color: 'pink' },
                                                { id: 'geral', label: 'üìö Geral', color: 'purple' }
                                            ].map(tema => (
                                                <button 
                                                    key={tema.id}
                                                    type="button"
                                                    onClick={() => { playSound('select'); setSubject(tema.id); }}
                                                    className={`p-3 rounded-lg border-4 pixel-font text-xs transition-all ${
                                                        subject === tema.id 
                                                            ? 'bg-blue-500 text-white border-blue-700 scale-105' 
                                                            : 'bg-white border-gray-300 hover:bg-blue-50 hover:border-blue-300'
                                                    }`}
                                                >
                                                    {tema.label}
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {/* Temas para ENSINO M√âDIO */}
                                    {educationLevel === 'medio' && (
                                        <div className="grid grid-cols-2 gap-2">
                                            {[
                                                { id: 'matematica', label: '‚ûï Matem√°tica', color: 'blue' },
                                                { id: 'portugues', label: 'üìñ Portugu√™s', color: 'red' },
                                                { id: 'fisica', label: '‚ö° F√≠sica', color: 'yellow' },
                                                { id: 'quimica', label: 'üß™ Qu√≠mica', color: 'green' },
                                                { id: 'biologia', label: 'üß¨ Biologia', color: 'lime' },
                                                { id: 'historia', label: 'üìú Hist√≥ria', color: 'orange' },
                                                { id: 'geografia', label: 'üåç Geografia', color: 'teal' },
                                                { id: 'filosofia', label: 'ü§î Filosofia', color: 'purple' },
                                                { id: 'sociologia', label: 'üë• Sociologia', color: 'indigo' },
                                                { id: 'ingles', label: 'üá∫üá∏ Ingl√™s', color: 'pink' }
                                            ].map(tema => (
                                                <button 
                                                    key={tema.id}
                                                    type="button"
                                                    onClick={() => { playSound('select'); setSubject(tema.id); }}
                                                    className={`p-3 rounded-lg border-4 pixel-font text-xs transition-all ${
                                                        subject === tema.id 
                                                            ? 'bg-blue-500 text-white border-blue-700 scale-105' 
                                                            : 'bg-white border-gray-300 hover:bg-blue-50 hover:border-blue-300'
                                                    }`}
                                                >
                                                    {tema.label}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Mostra √°rea escolhida se for ensino superior */}
                            {educationLevel === 'superior' && (
                                <div className="mb-4 bg-purple-50 p-3 rounded-lg border-2 border-purple-200">
                                    <p className="pixel-font text-xs text-purple-600">üéì √Årea: {course}</p>
                                </div>
                            )}

                            {/* Info sobre dificuldade progressiva */}
                            <div className="mb-4 bg-blue-50 p-3 rounded-lg border-2 border-blue-200">
                                <p className="pixel-font text-xs text-blue-600 text-center">‚ö° DIFICULDADE PROGRESSIVA</p>
                                <p className="text-xs text-blue-500 text-center mt-1">
                                    Come√ßa f√°cil e aumenta conforme voc√™ acerta!
                                </p>
                                <div className="flex justify-center gap-2 mt-2">
                                    <span className="bg-green-500 text-white px-2 py-1 rounded text-xs">üòä F√°cil</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-yellow-500 text-black px-2 py-1 rounded text-xs">üòê M√©dio</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-red-500 text-white px-2 py-1 rounded text-xs">üòà Dif√≠cil</span>
                                </div>
                            </div>

                            {errorMsg && <div className="text-red-500 text-xs mb-4 pixel-font text-center bg-red-100 p-2 rounded">{errorMsg}</div>}

                            <button 
                                onClick={startGame} 
                                className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-lg border-4 border-green-700 pixel-font hover:scale-105 transition-transform shadow-lg"
                            >
                                üéÆ INICIAR AVENTURA!
                            </button>

                            <button 
                                onClick={() => { playSound('select'); setScreen(educationLevel === 'superior' ? 'superior_config' : 'education'); }}
                                className="w-full mt-3 text-gray-500 pixel-font text-xs hover:text-gray-800 transition-colors"
                            >
                                ‚Üê VOLTAR
                            </button>
                        </div>

                        {/* Ch√£o */}
                        <div className="absolute bottom-0 left-0 right-0 h-12 bg-green-600 border-t-8 border-green-700"></div>
                    </div>
                );
            }

            if (screen === 'question') {
                const pName = currentPlayer === 1 ? player1Name : player2Name;
                
                // Emoji do personagem baseado no n√≠vel de ensino
                const getCharacterEmoji = () => {
                    if (characterMood === 'sad') return 'üò¢';
                    if (characterMood === 'happy') return 'üéâ';
                    
                    const emojis = {
                        'infantil': ['üßí', 'üëß', 'üêª', 'ü¶Å', 'üê∞'],
                        'fundamental1': ['üë¶', 'üëß', 'üìö', '‚úèÔ∏è', 'üéí'],
                        'fundamental2': ['üßë', 'üë©', 'üìñ', 'üî¨', 'üåç'],
                        'medio': ['üë®‚Äçüéì', 'üë©‚Äçüéì', 'üìê', 'üß™', 'üí°'],
                        'superior': ['üéì', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üìä', 'üî¨']
                    };
                    const levelEmojis = emojis[educationLevel] || ['üòä'];
                    return levelEmojis[currentQIndex % levelEmojis.length];
                };

                // Emojis tem√°ticos para perguntas infantis
                const getThemeEmoji = () => {
                    if (educationLevel !== 'infantil') return null;
                    
                    const perguntaLower = currentQuestion?.pergunta?.toLowerCase() || '';
                    
                    // Mapeia palavras-chave para emojis
                    const emojiMap = {
                        'cor': 'üé®', 'cores': 'üåà', 'vermelho': 'üî¥', 'azul': 'üîµ', 'amarelo': 'üü°', 'verde': 'üü¢',
                        'animal': 'üêæ', 'cachorro': 'üêï', 'gato': 'üê±', 'p√°ssaro': 'üê¶', 'peixe': 'üêü', 'le√£o': 'ü¶Å',
                        'elefante': 'üêò', 'macaco': 'üêµ', 'coelho': 'üê∞', 'urso': 'üêª', 'girafa': 'ü¶í', 'zebra': 'ü¶ì',
                        'fruta': 'üçé', 'ma√ß√£': 'üçé', 'banana': 'üçå', 'laranja': 'üçä', 'uva': 'üçá', 'morango': 'üçì',
                        'n√∫mero': 'üî¢', 'contar': 'üî¢', 'quantos': 'üî¢', 'quanto': 'üî¢',
                        'fam√≠lia': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'mam√£e': 'üë©', 'papai': 'üë®', 'irm√£o': 'üë¶', 'irm√£': 'üëß', 'vov√≥': 'üëµ', 'vov√¥': 'üë¥',
                        'casa': 'üè†', 'escola': 'üè´', 'parque': 'üèûÔ∏è',
                        'sol': '‚òÄÔ∏è', 'lua': 'üåô', 'estrela': '‚≠ê', 'chuva': 'üåßÔ∏è', 'nuvem': '‚òÅÔ∏è',
                        'carro': 'üöó', '√¥nibus': 'üöå', 'avi√£o': '‚úàÔ∏è', 'barco': 'üö¢', 'bicicleta': 'üö≤',
                        'bola': '‚öΩ', 'boneca': 'ü™Ü', 'brinquedo': 'üß∏',
                        'comida': 'üçΩÔ∏è', 'p√£o': 'üçû', 'leite': 'ü•õ', 'ovo': 'ü•ö',
                        '√°rvore': 'üå≥', 'flor': 'üå∏', 'folha': 'üçÉ',
                        'cora√ß√£o': '‚ù§Ô∏è', 'm√£o': '‚úã', 'p√©': 'ü¶∂', 'olho': 'üëÅÔ∏è', 'boca': 'üëÑ',
                    };
                    
                    for (const [palavra, emoji] of Object.entries(emojiMap)) {
                        if (perguntaLower.includes(palavra)) {
                            return emoji;
                        }
                    }
                    
                    // Emojis gen√©ricos para infantil
                    const genericEmojis = ['üåü', 'üéà', 'üéÄ', 'üåª', 'ü¶ã', 'üêù', 'üå∫'];
                    return genericEmojis[Math.floor(Math.random() * genericEmojis.length)];
                };
                
                return (
                    <div className="min-h-screen bg-gradient-to-b from-sky-300 to-sky-100 p-4">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        <AccessibilityButton enabled={accessibilityEnabled} onClick={toggleAccessibility} />
                        
                        {/* Modal de Acessibilidade */}
                        {showAccessibilityModal && (
                            <AccessibilityModal 
                                onClose={() => setShowAccessibilityModal(false)}
                                onActivate={activateAccessibility}
                            />
                        )}

                        {/* Indicador de acessibilidade ativa */}
                        {accessibilityEnabled && (
                            <div className="fixed bottom-4 left-4 z-40 bg-blue-500 text-white px-3 py-1 rounded-full text-xs pixel-font flex items-center gap-1">
                                ‚ôø {isReading ? 'üîä Lendo...' : 'Ativo'}
                            </div>
                        )}

                        {/* Notifica√ß√£o de vida extra - MAIOR E MAIS VIS√çVEL */}
                        {showBonusLife && (
                            <div className="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
                                <div className="bg-gradient-to-b from-green-400 to-green-600 text-white px-8 py-6 rounded-2xl border-8 border-green-300 pixel-font text-center animate-bounce shadow-2xl">
                                    <div className="text-6xl mb-3">‚ù§Ô∏è</div>
                                    <div className="text-2xl mb-2">+1 VIDA!</div>
                                    <div className="text-lg text-green-100">VOC√ä GANHOU</div>
                                    <div className="text-lg text-green-100">UMA VIDA EXTRA!</div>
                                    <div className="text-sm mt-3 text-green-200">üî• 3 acertos seguidos! üî•</div>
                                </div>
                            </div>
                        )}

                        {/* Indicador de dificuldade atual */}
                        <div className="text-center mb-2">
                            <span className={`pixel-font text-xs px-3 py-1 rounded-full ${
                                difficulty === 'facil' ? 'bg-green-500 text-white' :
                                difficulty === 'medio' ? 'bg-yellow-500 text-black' :
                                'bg-red-500 text-white'
                            }`}>
                                {difficulty === 'facil' ? 'üòä F√ÅCIL' : difficulty === 'medio' ? 'üòê M√âDIO' : 'üòà DIF√çCIL'}
                            </span>
                        </div>

                        {/* Placar */}
                        <div className="bg-black text-white p-2 md:p-3 rounded-lg border-2 md:border-4 border-white mb-2 md:mb-4 pixel-font text-xs flex justify-between items-center">
                            <div className={`${currentPlayer === 1 ? "text-yellow-400" : "text-gray-500"} truncate max-w-[40%]`}>
                                üî¥ {player1Name.substring(0, 6)}: {player1Score}
                                <span className="hidden md:inline"> {Array(Math.max(0, player1Lives)).fill('‚ù§Ô∏è').join('')}</span>
                                <span className="md:hidden"> {player1Lives}‚ù§Ô∏è</span>
                                {player1Streak > 0 && <span className="text-orange-400 ml-1">üî•{player1Streak}</span>}
                            </div>
                            <div className="text-center">
                                <span className="text-white">#{currentQIndex + 1}</span>
                            </div>
                            {gameMode === '2P' && (
                                <div className={`${currentPlayer === 2 ? "text-yellow-400" : "text-gray-500"} truncate max-w-[40%] text-right`}>
                                    üü¢ {player2Name.substring(0, 6)}: {player2Score}
                                    <span className="hidden md:inline"> {Array(Math.max(0, player2Lives)).fill('‚ù§Ô∏è').join('')}</span>
                                    <span className="md:hidden"> {player2Lives}‚ù§Ô∏è</span>
                                    {player2Streak > 0 && <span className="text-orange-400 ml-1">üî•{player2Streak}</span>}
                                </div>
                            )}
                        </div>
                        {/* Personagem */}
                        <div className="flex justify-center items-end h-24 md:h-32 mb-2 md:mb-4 relative border-b-4 md:border-b-8 border-green-700 bg-sky-200 rounded-lg overflow-hidden">
                            <div className="absolute top-2 left-5 md:left-10 text-2xl md:text-4xl opacity-80" style={{animation: 'floatCloud 3s ease-in-out infinite'}}>‚òÅÔ∏è</div>
                            <div className="flex flex-col items-center z-10">
                                {isLoading && <div className="speech-bubble mb-1 md:mb-2 text-xs">Pensando<span className="loading-dots"></span></div>}
                                {!isLoading && characterMood === 'happy' && <div className="speech-bubble mb-1 md:mb-2 text-xs">Muito bem! üéâ</div>}
                                {!isLoading && characterMood === 'sad' && <div className="speech-bubble mb-1 md:mb-2 text-xs">N√£o foi dessa vez...</div>}
                                <div className={`character-container character-${characterMood}`} style={{fontSize: '40px'}}>
                                    {getCharacterEmoji()}
                                </div>
                            </div>
                        </div>

                        {/* Pergunta */}
                        <div className="max-w-2xl mx-auto px-1 md:px-0">
                            {!showExplanation && currentQuestion && !isLoading ? (
                                <>
                                    <div 
                                        className="bg-yellow-100 border-2 md:border-4 border-yellow-600 p-3 md:p-4 rounded-lg mb-2 md:mb-4 shadow-lg"
                                        onClick={() => accessibilityEnabled && speak(`Pergunta: ${currentQuestion.pergunta}`)}
                                    >
                                        <div className="pixel-font text-xs text-blue-600 mb-1 md:mb-2">
                                            {gameMode === '2P' ? `VEZ DE: ${pName}` : subject.toUpperCase()}
                                        </div>
                                        
                                        <p className={`font-bold font-sans ${educationLevel === 'infantil' ? 'text-lg md:text-xl text-center' : 'text-base md:text-lg'}`}>
                                            {currentQuestion.pergunta}
                                        </p>
                                    </div>
                                    <div className="grid grid-cols-1 gap-2">
                                        {Object.entries(currentQuestion.alternativas).map(([key, value]) => (
                                            <button 
                                                key={key} 
                                                onClick={() => handleAccessibleClick(
                                                    `Alternativa ${key}: ${value}`,
                                                    () => handleAnswer(key)
                                                )} 
                                                className={`bg-white hover:bg-blue-100 active:bg-blue-200 text-left p-2 md:p-3 rounded-lg border-b-4 border-gray-300 font-bold flex items-center ${educationLevel === 'infantil' ? 'text-base md:text-lg' : 'text-sm md:text-base'} active:scale-98 transition-transform`}
                                            >
                                                <span className="bg-blue-600 text-white w-7 h-7 md:w-8 md:h-8 flex items-center justify-center rounded mr-2 md:mr-3 text-sm md:text-base flex-shrink-0">{key}</span>
                                                <span className="break-words">{value}</span>
                                            </button>
                                        ))}
                                    </div>
                                </>
                            ) : showExplanation ? (
                                <div className={`p-4 md:p-6 rounded-lg border-4 text-center shadow-2xl ${explanationData.correct ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'}`}>
                                    <div className="text-4xl md:text-5xl mb-2 md:mb-3">{explanationData.correct ? '‚≠ê' : 'üò¢'}</div>
                                    <h2 className="text-xl md:text-2xl font-bold mb-2 md:mb-4 pixel-font">{explanationData.correct ? 'CORRETO!' : 'ERROU!'}</h2>
                                    <p className="text-sm md:text-lg mb-4 md:mb-6">{explanationData.text}</p>
                                    <button 
                                        onClick={() => handleAccessibleClick('Bot√£o Continuar', nextStep)} 
                                        className="bg-black text-white px-6 md:px-8 py-2 md:py-3 rounded pixel-font text-sm md:text-base active:scale-95"
                                    >
                                        CONTINUAR ‚û§
                                    </button>
                                </div>
                            ) : null}
                            
                            {errorMsg && <div className="text-center text-red-600 pixel-font text-xs mt-2">{errorMsg}</div>}
                        </div>
                    </div>
                );
            }

            if (screen === 'gameover') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black flex flex-col items-center justify-center text-white p-4 fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* Estrelas de fundo */}
                        <div className="absolute inset-0 overflow-hidden">
                            {[...Array(30)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-yellow-300"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 100}%`,
                                        animation: `twinkle ${1 + Math.random() * 2}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`,
                                        fontSize: `${Math.random() * 8 + 4}px`
                                    }}
                                >‚òÖ</div>
                            ))}
                        </div>

                        <div className="relative z-10 flex flex-col items-center">
                            <h1 className="text-4xl md:text-6xl text-red-500 pixel-font mb-8 text-center" style={{textShadow: '4px 4px 0px #000'}}>
                                GAME OVER
                            </h1>
                            
                            <div className="flex flex-col gap-4">
                                <button 
                                    onClick={() => { playSound('select'); setScreen('prestart'); }} 
                                    className="bg-white hover:bg-gray-100 text-black px-8 py-4 rounded-lg border-4 border-gray-400 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üè† MENU INICIAL
                                </button>
                                <button 
                                    onClick={() => { 
                                        playSound('select'); 
                                        // Salvar no ranking antes de ir
                                        if (gameMode === '1P') {
                                            saveToRanking(player1Name, player1Score);
                                        } else {
                                            saveToRanking(player1Name, player1Score);
                                            saveToRanking(player2Name, player2Score);
                                        }
                                        setScreen('ranking'); 
                                    }} 
                                    className="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-4 rounded-lg border-4 border-yellow-600 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üèÜ VER RANKING
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA DE RANKING
            if (screen === 'ranking') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-yellow-600 via-yellow-500 to-orange-500 p-4 flex flex-col items-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* Estrelas decorativas */}
                        <div className="absolute inset-0 overflow-hidden">
                            {[...Array(20)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-yellow-200"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 100}%`,
                                        animation: `twinkle ${1 + Math.random() * 2}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`,
                                        fontSize: `${Math.random() * 15 + 10}px`
                                    }}
                                >‚≠ê</div>
                            ))}
                        </div>

                        <div className="relative z-10 w-full max-w-2xl">
                            {/* T√≠tulo */}
                            <div className="text-center mb-6 mt-4">
                                <div className="text-6xl mb-2">üèÜ</div>
                                <h1 className="text-2xl md:text-4xl text-white pixel-font" style={{textShadow: '3px 3px 0px #92400e'}}>
                                    RANKING
                                </h1>
                                <p className="text-yellow-200 pixel-font text-xs mt-2">TOP 10 JOGADORES</p>
                            </div>

                            {/* Tabela de Ranking */}
                            <div className="bg-white rounded-xl border-4 border-yellow-800 shadow-2xl overflow-hidden">
                                {/* Cabe√ßalho */}
                                <div className="bg-yellow-800 text-white p-3 pixel-font text-xs grid grid-cols-12 gap-1">
                                    <div className="col-span-1 text-center">#</div>
                                    <div className="col-span-2">NOME</div>
                                    <div className="col-span-3">MAT√âRIA</div>
                                    <div className="col-span-2">N√çVEL</div>
                                    <div className="col-span-2">DIFIC.</div>
                                    <div className="col-span-2 text-right">PTS</div>
                                </div>

                                {/* Lista */}
                                <div className="max-h-80 overflow-y-auto">
                                    {ranking.length === 0 ? (
                                        <div className="p-8 text-center text-gray-500 pixel-font text-xs">
                                            Nenhum jogador ainda.<br/>Seja o primeiro! üéÆ
                                        </div>
                                    ) : (
                                        ranking.map((entry, index) => (
                                            <div 
                                                key={entry.id} 
                                                className={`p-3 pixel-font text-xs grid grid-cols-12 gap-1 items-center border-b border-gray-200 ${
                                                    index === 0 ? 'bg-yellow-100' : 
                                                    index === 1 ? 'bg-gray-100' : 
                                                    index === 2 ? 'bg-orange-50' : 'bg-white'
                                                }`}
                                            >
                                                <div className="col-span-1 text-center font-bold">
                                                    {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`}
                                                </div>
                                                <div className="col-span-2 truncate font-bold text-gray-800">
                                                    {entry.name}
                                                </div>
                                                <div className="col-span-3 truncate text-blue-600">
                                                    {entry.course ? `${entry.course}: ${entry.subject}` : entry.subject}
                                                </div>
                                                <div className="col-span-2 text-purple-600">
                                                    {getEducationLabel(entry.educationLevel)}
                                                </div>
                                                <div className="col-span-2">
                                                    {getDifficultyLabel(entry.difficulty)}
                                                </div>
                                                <div className="col-span-2 text-right font-bold text-green-600">
                                                    {entry.score}
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>

                            {/* Bot√µes */}
                            <div className="flex flex-col md:flex-row gap-4 mt-6 justify-center">
                                <button 
                                    onClick={() => { playSound('select'); setScreen('prestart'); }} 
                                    className="bg-white hover:bg-gray-100 text-yellow-800 px-6 py-3 rounded-lg border-4 border-yellow-800 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üè† MENU
                                </button>
                                {ranking.length > 0 && (
                                    <button 
                                        onClick={clearRanking} 
                                        className="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded-lg border-4 border-red-800 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                    >
                                        üóëÔ∏è LIMPAR
                                    </button>
                                )}
                                <button 
                                    onClick={() => { playSound('start'); setScreen('mode'); }} 
                                    className="bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg border-4 border-green-800 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üéÆ JOGAR
                                </button>
                            </div>

                            {/* Cr√©ditos */}
                            <div className="text-center mt-6">
                                <p className="text-yellow-900 pixel-font text-xs opacity-80">¬© 2025 QUIZ EDUCATIVO</p>
                                <p className="text-yellow-900 pixel-font text-xs opacity-60 mt-1">por M. Dancini, Claude IA, GPT e GEMINI</p>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA DE VIT√ìRIA (9999 pontos)
            if (screen === 'victory') {
                const winnerName = currentPlayer === 1 ? player1Name : player2Name;
                
                return (
                    <div className="min-h-screen bg-gradient-to-b from-yellow-400 via-orange-400 to-red-500 flex flex-col items-center justify-center text-white p-4 fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* Confetes animados */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            {[...Array(50)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-2xl"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `-20px`,
                                        animation: `confettiFall ${3 + Math.random() * 4}s linear infinite`,
                                        animationDelay: `${Math.random() * 3}s`
                                    }}
                                >{['üéâ', 'üéä', '‚≠ê', 'üåü', '‚ú®', 'üèÜ', 'üëë', 'üí´'][Math.floor(Math.random() * 8)]}</div>
                            ))}
                        </div>

                        {/* Fogos de artif√≠cio */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            {[...Array(10)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-4xl"
                                    style={{
                                        left: `${10 + Math.random() * 80}%`,
                                        top: `${10 + Math.random() * 40}%`,
                                        animation: `firework ${1 + Math.random() * 2}s ease-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`
                                    }}
                                >üéÜ</div>
                            ))}
                        </div>

                        <div className="relative z-10 flex flex-col items-center text-center">
                            <div className="text-8xl mb-4 animate-bounce">üèÜ</div>
                            
                            <h1 className="text-3xl md:text-5xl text-white pixel-font mb-4" style={{textShadow: '4px 4px 0px #c53030'}}>
                                PARAB√âNS!
                            </h1>
                            
                            <h2 className="text-xl md:text-3xl text-yellow-100 pixel-font mb-4" style={{textShadow: '2px 2px 0px #000'}}>
                                {winnerName}
                            </h2>
                            
                            <div className="bg-white text-black px-8 py-4 rounded-xl border-4 border-yellow-600 mb-6 shadow-2xl">
                                <p className="pixel-font text-lg mb-2">VOC√ä CHEGOU AO</p>
                                <p className="pixel-font text-4xl text-green-600 font-bold">FINAL DO JOGO!</p>
                                <p className="pixel-font text-2xl text-yellow-600 mt-2">9999 PONTOS</p>
                            </div>
                            
                            <p className="text-white pixel-font text-sm mb-8 max-w-md" style={{textShadow: '1px 1px 0px #000'}}>
                                Voc√™ demonstrou um conhecimento incr√≠vel! Continue assim e nunca pare de aprender!
                            </p>
                            
                            <div className="flex flex-col gap-4">
                                <button 
                                    onClick={() => { 
                                        playSound('select');
                                        saveToRanking(winnerName, 9999);
                                        setScreen('ranking'); 
                                    }} 
                                    className="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-4 rounded-lg border-4 border-yellow-700 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üèÜ VER RANKING
                                </button>
                                <button 
                                    onClick={() => { playSound('select'); setScreen('prestart'); }} 
                                    className="bg-white hover:bg-gray-100 text-black px-8 py-4 rounded-lg border-4 border-gray-400 pixel-font hover:scale-105 transition-all shadow-lg text-sm"
                                >
                                    üè† MENU INICIAL
                                </button>
                            </div>
                            
                            {/* Cr√©ditos */}
                            <div className="text-center mt-8">
                                <p className="text-white pixel-font text-xs opacity-80" style={{textShadow: '1px 1px 0px #000'}}>¬© 2025 QUIZ EDUCATIVO</p>
                                <p className="text-white pixel-font text-xs opacity-60 mt-1" style={{textShadow: '1px 1px 0px #000'}}>por M. Dancini, Claude IA, GPT e GEMINI</p>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA DE FEEDBACK
            if (screen === 'feedback') {
                const educationOptions = [
                    { value: 'infantil', label: 'üßí Educa√ß√£o Infantil', color: 'pink' },
                    { value: 'fundamental1', label: 'üë¶ Fundamental I', color: 'orange' },
                    { value: 'fundamental2', label: 'üßë Fundamental II', color: 'green' },
                    { value: 'medio', label: 'üë®‚Äçüéì Ensino M√©dio', color: 'blue' },
                    { value: 'superior', label: 'üéì Ensino Superior', color: 'purple' }
                ];

                return (
                    <div className="min-h-screen bg-gradient-to-b from-purple-800 via-purple-600 to-indigo-700 p-4 flex flex-col items-center fade-in relative overflow-hidden">
                        <SoundButton soundEnabled={soundEnabled} onClick={toggleSound} />
                        
                        {/* √çcones decorativos */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            {[...Array(15)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className="absolute text-2xl opacity-30"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `${Math.random() * 100}%`,
                                        animation: `floatCloud ${4 + Math.random() * 4}s ease-in-out infinite`,
                                        animationDelay: `${Math.random() * 2}s`
                                    }}
                                >{['üí°', '‚ú®', 'üìù', 'üéØ', '‚≠ê'][Math.floor(Math.random() * 5)]}</div>
                            ))}
                        </div>

                        <div className="relative z-10 w-full max-w-lg mt-4">
                            {!feedbackSent ? (
                                <>
                                    {/* T√≠tulo */}
                                    <div className="text-center mb-6">
                                        <div className="text-5xl mb-3">üí°</div>
                                        <h1 className="text-xl md:text-2xl text-white pixel-font" style={{textShadow: '2px 2px 0px #581c87'}}>
                                            AJUDE A MELHORAR
                                        </h1>
                                        <p className="text-purple-200 text-sm mt-2 font-sans">
                                            Sua opini√£o √© importante para melhorarmos as perguntas!
                                        </p>
                                    </div>

                                    {/* Formul√°rio */}
                                    <div className="bg-white rounded-xl border-4 border-purple-900 p-4 md:p-6 shadow-2xl">
                                        
                                        {/* Sele√ß√£o de N√≠vel */}
                                        <div className="mb-4">
                                            <label className="block pixel-font text-xs mb-2 text-purple-700">üìö N√çVEL DE ENSINO:</label>
                                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                                                {educationOptions.map(opt => (
                                                    <button
                                                        key={opt.value}
                                                        onClick={() => { playSound('select'); setFeedbackEducation(opt.value); }}
                                                        className={`p-2 rounded-lg border-2 text-xs font-bold transition-all ${
                                                            feedbackEducation === opt.value 
                                                                ? 'bg-purple-600 text-white border-purple-800 scale-105' 
                                                                : 'bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200'
                                                        }`}
                                                    >
                                                        {opt.label}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Mat√©ria */}
                                        <div className="mb-4">
                                            <label className="block pixel-font text-xs mb-2 text-blue-600">üìñ MAT√âRIA/CONTE√öDO:</label>
                                            <input 
                                                type="text" 
                                                value={feedbackSubject} 
                                                onChange={(e) => setFeedbackSubject(e.target.value)} 
                                                placeholder="Ex: Matem√°tica, Hist√≥ria, Biologia..."
                                                className="w-full p-3 border-4 border-gray-300 rounded-lg text-sm focus:border-blue-500 outline-none transition-colors"
                                            />
                                        </div>

                                        {/* Texto do Feedback */}
                                        <div className="mb-4">
                                            <label className="block pixel-font text-xs mb-2 text-green-600">‚úèÔ∏è O QUE GOSTARIA DE MELHORAR?</label>
                                            <textarea 
                                                value={feedbackText} 
                                                onChange={(e) => setFeedbackText(e.target.value)} 
                                                placeholder="Descreva o que voc√™ observou e como podemos melhorar as perguntas. Ex: 'As perguntas est√£o muito dif√≠ceis para crian√ßas', 'Gostaria de mais perguntas sobre fra√ß√µes', 'As alternativas s√£o muito parecidas'..."
                                                rows={4}
                                                className="w-full p-3 border-4 border-gray-300 rounded-lg text-sm focus:border-green-500 outline-none transition-colors resize-none"
                                            />
                                        </div>

                                        {errorMsg && (
                                            <div className="text-red-500 text-xs mb-4 pixel-font text-center bg-red-100 p-2 rounded">
                                                {errorMsg}
                                            </div>
                                        )}

                                        {/* Bot√µes */}
                                        <div className="flex flex-col gap-3">
                                            <button 
                                                onClick={sendFeedback}
                                                disabled={feedbackLoading}
                                                className="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg border-4 border-green-800 pixel-font text-sm hover:scale-105 transition-transform shadow-lg disabled:opacity-50 disabled:cursor-not-allowed active:scale-95"
                                            >
                                                {feedbackLoading ? (
                                                    <span>PROCESSANDO<span className="loading-dots"></span></span>
                                                ) : (
                                                    '‚úÖ ENVIAR SUGEST√ÉO'
                                                )}
                                            </button>
                                            
                                            <button 
                                                onClick={() => { playSound('select'); setScreen('prestart'); }}
                                                className="w-full text-gray-500 pixel-font text-xs hover:text-gray-800 transition-colors py-2"
                                            >
                                                ‚Üê VOLTAR AO MENU
                                            </button>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <>
                                    {/* Mensagem de Sucesso */}
                                    <div className="text-center mb-6">
                                        <div className="text-6xl mb-4 animate-bounce">‚úÖ</div>
                                        <h1 className="text-xl md:text-2xl text-white pixel-font mb-2" style={{textShadow: '2px 2px 0px #166534'}}>
                                            ENVIADO COM SUCESSO!
                                        </h1>
                                        <p className="text-green-200 text-sm font-sans">
                                            Obrigado por ajudar a melhorar o jogo!
                                        </p>
                                    </div>

                                    {/* Sugest√£o da IA */}
                                    <div className="bg-white rounded-xl border-4 border-green-600 p-4 md:p-6 shadow-2xl mb-6">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="text-2xl">ü§ñ</span>
                                            <h2 className="pixel-font text-sm text-green-700">AN√ÅLISE DA IA:</h2>
                                        </div>
                                        <div className="bg-gray-50 rounded-lg p-4 max-h-60 overflow-y-auto">
                                            <p className="text-gray-700 text-sm whitespace-pre-wrap font-sans leading-relaxed">
                                                {aiSuggestion}
                                            </p>
                                        </div>
                                    </div>

                                    {/* Bot√£o Voltar */}
                                    <button 
                                        onClick={() => { 
                                            playSound('select'); 
                                            resetFeedback();
                                            setScreen('prestart'); 
                                        }}
                                        className="w-full bg-white hover:bg-gray-100 text-purple-800 font-bold py-4 rounded-lg border-4 border-purple-300 pixel-font text-sm hover:scale-105 transition-transform shadow-lg active:scale-95"
                                    >
                                        üè† VOLTAR AO MENU PRINCIPAL
                                    </button>
                                </>
                            )}
                        </div>

                        {/* Cr√©ditos */}
                        <div className="absolute bottom-4 left-0 right-0 text-center">
                            <p className="text-purple-200 pixel-font text-xs opacity-60">¬© 2025 QUIZ EDUCATIVO</p>
                        </div>
                    </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MarioQuizGame />);
    </script>
</body>
</html>
